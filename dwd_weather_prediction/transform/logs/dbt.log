[0m22:59:15.210474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108520050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10953fd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10953fc50>]}


============================== 22:59:15.227152 | 83122eac-1b98-41ac-89ca-9e55d40705c1 ==============================
[0m22:59:15.227152 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:59:15.227417 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'partial_parse': 'True', 'invocation_command': 'dbt deps --profiles-dir .', 'log_path': '/Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/logs', 'empty': 'None', 'printer_width': '80', 'profiles_dir': '.', 'cache_selected_only': 'False', 'fail_fast': 'False', 'log_format': 'default', 'no_print': 'None', 'use_experimental_parser': 'False', 'static_parser': 'True', 'log_cache_events': 'False', 'warn_error': 'None', 'indirect_selection': 'eager', 'debug': 'False', 'quiet': 'False', 'write_json': 'True', 'target_path': 'None'}
[0m22:59:15.283851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '83122eac-1b98-41ac-89ca-9e55d40705c1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108808180>]}
[0m22:59:15.318326 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m22:59:15.318679 [info ] [MainThread]: Warning: No packages were found in packages.yml
[0m22:59:15.320446 [debug] [MainThread]: Resource report: {"command_name": "deps", "command_success": true, "command_wall_clock_time": 0.1402412, "process_in_blocks": "0", "process_kernel_time": 0.243128, "process_mem_max_rss": "139575296", "process_out_blocks": "0", "process_user_time": 1.250998}
[0m22:59:15.320660 [debug] [MainThread]: Command `dbt deps` succeeded at 22:59:15.320614 after 0.14 seconds
[0m22:59:15.320804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095ac9e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095adf20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094cde50>]}
[0m22:59:15.320941 [debug] [MainThread]: Flushing usage events
[0m22:59:15.802023 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:59:30.152912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c028050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0d39d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0d3b10>]}


============================== 22:59:30.154843 | 0e9c9d92-d5e0-4055-a507-e96b34c5f32d ==============================
[0m22:59:30.154843 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:59:30.155097 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'version_check': 'True', 'fail_fast': 'False', 'invocation_command': 'dbt build --profiles-dir .', 'use_colors': 'True', 'write_json': 'True', 'warn_error': 'None', 'debug': 'False', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'profiles_dir': '.', 'static_parser': 'True', 'introspect': 'True', 'log_path': '/Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/logs', 'cache_selected_only': 'False', 'no_print': 'None', 'printer_width': '80', 'target_path': 'None', 'empty': 'False', 'log_format': 'default'}
[0m22:59:30.903155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0e9c9d92-d5e0-4055-a507-e96b34c5f32d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c41cb00>]}
[0m22:59:30.924703 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0e9c9d92-d5e0-4055-a507-e96b34c5f32d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf8f8a0>]}
[0m22:59:30.926813 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m22:59:30.968902 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:59:30.969256 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m22:59:30.969414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '0e9c9d92-d5e0-4055-a507-e96b34c5f32d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d1df050>]}
[0m22:59:31.352930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0e9c9d92-d5e0-4055-a507-e96b34c5f32d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bafcf50>]}
[0m22:59:31.374018 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m22:59:31.374897 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m22:59:31.446155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0e9c9d92-d5e0-4055-a507-e96b34c5f32d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d777e70>]}
[0m22:59:31.446388 [info ] [MainThread]: Found 2 models, 468 macros
[0m22:59:31.447148 [info ] [MainThread]: 
[0m22:59:31.447280 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:59:31.447381 [info ] [MainThread]: 
[0m22:59:31.447575 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m22:59:31.449299 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_weather'
[0m22:59:31.480663 [debug] [ThreadPool]: Using duckdb connection "list_weather"
[0m22:59:31.480843 [debug] [ThreadPool]: On list_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"weather"'
    
  
  
[0m22:59:31.480951 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:59:31.947623 [debug] [ThreadPool]: SQL status: OK in 0.467 seconds
[0m22:59:31.948372 [debug] [ThreadPool]: On list_weather: Close
[0m22:59:31.948683 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_weather, now create_weather_main)
[0m22:59:31.948883 [debug] [ThreadPool]: Creating schema "database: "weather"
schema: "main"
"
[0m22:59:31.951885 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m22:59:31.952025 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='weather'
        and type='sqlite'
    
  
[0m22:59:31.952143 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:59:31.952472 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m22:59:31.953005 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m22:59:31.953125 [debug] [ThreadPool]: On create_weather_main: BEGIN
[0m22:59:31.953292 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m22:59:31.953391 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m22:59:31.953501 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
    
        create schema if not exists "weather"."main"
    
[0m22:59:31.953725 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m22:59:31.954048 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m22:59:31.954169 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m22:59:31.954275 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m22:59:31.954428 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m22:59:31.954537 [debug] [ThreadPool]: On create_weather_main: Close
[0m22:59:31.955008 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_weather_main, now list_weather_main)
[0m22:59:31.957309 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m22:59:31.957464 [debug] [ThreadPool]: On list_weather_main: BEGIN
[0m22:59:31.957571 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:59:31.957729 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m22:59:31.957830 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m22:59:31.957935 [debug] [ThreadPool]: On list_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather_main"} */
select
      'weather' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'weather'
  
[0m22:59:31.962291 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m22:59:31.962810 [debug] [ThreadPool]: On list_weather_main: ROLLBACK
[0m22:59:31.963763 [debug] [ThreadPool]: Failed to rollback 'list_weather_main'
[0m22:59:31.963892 [debug] [ThreadPool]: On list_weather_main: Close
[0m22:59:31.964126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0e9c9d92-d5e0-4055-a507-e96b34c5f32d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d72b5f0>]}
[0m22:59:31.964361 [debug] [MainThread]: Using duckdb connection "master"
[0m22:59:31.964492 [debug] [MainThread]: On master: BEGIN
[0m22:59:31.964603 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:59:31.964797 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m22:59:31.964909 [debug] [MainThread]: On master: COMMIT
[0m22:59:31.965016 [debug] [MainThread]: Using duckdb connection "master"
[0m22:59:31.965117 [debug] [MainThread]: On master: COMMIT
[0m22:59:31.965292 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m22:59:31.965438 [debug] [MainThread]: On master: Close
[0m22:59:31.967032 [debug] [Thread-1 (]: Began running node model.dwd_weather.stg_weather
[0m22:59:31.967238 [info ] [Thread-1 (]: 1 of 2 START sql view model main.stg_weather ................................... [RUN]
[0m22:59:31.967405 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_weather_main, now model.dwd_weather.stg_weather)
[0m22:59:31.967533 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.stg_weather
[0m22:59:31.969928 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.stg_weather"
[0m22:59:31.970324 [debug] [Thread-1 (]: Began executing node model.dwd_weather.stg_weather
[0m22:59:31.982492 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.stg_weather"
[0m22:59:31.982971 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m22:59:31.983105 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: BEGIN
[0m22:59:31.983222 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:59:31.983485 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m22:59:31.983602 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m22:59:31.983725 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

  
  create view "weather"."main"."stg_weather__dbt_tmp" as (
    with source as (
    select * from read_csv_auto('../data/raw/dwd_daily_01078.csv')
),

renamed as (
    select
        station_id,
        date::date as date,
        parameter,
        value,
        quality
    from source
)

select * from renamed
  );

[0m22:59:32.024248 [debug] [Thread-1 (]: SQL status: OK in 0.040 seconds
[0m22:59:32.026873 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m22:59:32.027019 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather__dbt_tmp" rename to "stg_weather"
[0m22:59:32.027320 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m22:59:32.030738 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m22:59:32.030865 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m22:59:32.030971 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m22:59:32.031478 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m22:59:32.033544 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m22:59:32.033673 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

      drop view if exists "weather"."main"."stg_weather__dbt_backup" cascade
    
[0m22:59:32.033873 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m22:59:32.034768 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: Close
[0m22:59:32.035724 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e9c9d92-d5e0-4055-a507-e96b34c5f32d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e24e390>]}
[0m22:59:32.035947 [info ] [Thread-1 (]: 1 of 2 OK created sql view model main.stg_weather .............................. [[32mOK[0m in 0.07s]
[0m22:59:32.036165 [debug] [Thread-1 (]: Finished running node model.dwd_weather.stg_weather
[0m22:59:32.036484 [debug] [Thread-1 (]: Began running node model.dwd_weather.int_weather_features
[0m22:59:32.036667 [info ] [Thread-1 (]: 2 of 2 START sql view model main.int_weather_features .......................... [RUN]
[0m22:59:32.036829 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dwd_weather.stg_weather, now model.dwd_weather.int_weather_features)
[0m22:59:32.036959 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.int_weather_features
[0m22:59:32.037952 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.int_weather_features"
[0m22:59:32.038266 [debug] [Thread-1 (]: Began executing node model.dwd_weather.int_weather_features
[0m22:59:32.039514 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.int_weather_features"
[0m22:59:32.039786 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m22:59:32.039905 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: BEGIN
[0m22:59:32.040010 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:59:32.040219 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m22:59:32.040339 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m22:59:32.040497 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

  
  create view "weather"."main"."int_weather_features__dbt_tmp" as (
    with weather_data as (
    select * from "weather"."main"."stg_weather"
),

pivoted as (
    select
        date,
        max(case when parameter = 'temperature_air_mean_2m' then value end) as temp_mean,
        max(case when parameter = 'temperature_air_max_2m' then value end) as temp_max,
        max(case when parameter = 'temperature_air_min_2m' then value end) as temp_min,
        max(case when parameter = 'wind_speed' then value end) as wind_speed,
        max(case when parameter = 'precipitation_height' then value end) as precipitation,
        max(case when parameter = 'humidity' then value end) as humidity,
        max(case when parameter = 'sunshine_duration' then value end) as sunshine
    from weather_data
    group by date
),

cleaned as (
    select
        date,
        -- Simple interpolation or filling could be done here, but SQL window functions for interpolation are complex.
        -- We will assume data is mostly complete or handle nulls in training.
        -- For now, let's just use the values.
        temp_mean,
        temp_max,
        temp_min,
        wind_speed,
        coalesce(precipitation, 0) as precipitation, -- Assume 0 if null for precip
        humidity,
        sunshine,
        case when coalesce(precipitation, 0) > 0 then 1 else 0 end as is_raining
    from pivoted
),

features as (
    select
        *,
        -- Lag features (Past 1 day)
        lag(temp_mean, 1) over (order by date) as temp_mean_lag_1,
        lag(temp_max, 1) over (order by date) as temp_max_lag_1,
        lag(temp_min, 1) over (order by date) as temp_min_lag_1,
        lag(wind_speed, 1) over (order by date) as wind_speed_lag_1,
        lag(humidity, 1) over (order by date) as humidity_lag_1,
        lag(precipitation, 1) over (order by date) as precipitation_lag_1,

        -- Targets (Next 1 day)
        lead(temp_mean, 1) over (order by date) as target_temp_mean_day_1,
        lead(temp_max, 1) over (order by date) as target_temp_max_day_1,
        lead(temp_min, 1) over (order by date) as target_temp_min_day_1,
        lead(wind_speed, 1) over (order by date) as target_wind_speed_day_1,
        lead(humidity, 1) over (order by date) as target_humidity_day_1,
        lead(is_raining, 1) over (order by date) as target_is_raining_day_1
    from cleaned
)

select * from features
where date < current_date -- Filter out future empty rows if any
  );

[0m22:59:32.077231 [debug] [Thread-1 (]: SQL status: OK in 0.037 seconds
[0m22:59:32.078436 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m22:59:32.078567 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features__dbt_tmp" rename to "int_weather_features"
[0m22:59:32.078840 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m22:59:32.079295 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m22:59:32.079409 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m22:59:32.079532 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m22:59:32.079994 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m22:59:32.080796 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m22:59:32.080918 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

      drop view if exists "weather"."main"."int_weather_features__dbt_backup" cascade
    
[0m22:59:32.081124 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m22:59:32.081587 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: Close
[0m22:59:32.081803 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e9c9d92-d5e0-4055-a507-e96b34c5f32d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e2028e0>]}
[0m22:59:32.082066 [info ] [Thread-1 (]: 2 of 2 OK created sql view model main.int_weather_features ..................... [[32mOK[0m in 0.04s]
[0m22:59:32.082287 [debug] [Thread-1 (]: Finished running node model.dwd_weather.int_weather_features
[0m22:59:32.082762 [debug] [MainThread]: Using duckdb connection "master"
[0m22:59:32.082866 [debug] [MainThread]: On master: BEGIN
[0m22:59:32.082955 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:59:32.083122 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m22:59:32.083221 [debug] [MainThread]: On master: COMMIT
[0m22:59:32.083317 [debug] [MainThread]: Using duckdb connection "master"
[0m22:59:32.083411 [debug] [MainThread]: On master: COMMIT
[0m22:59:32.083546 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m22:59:32.083645 [debug] [MainThread]: On master: Close
[0m22:59:32.083769 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:59:32.083865 [debug] [MainThread]: Connection 'model.dwd_weather.int_weather_features' was properly closed.
[0m22:59:32.083978 [info ] [MainThread]: 
[0m22:59:32.084089 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 0.64 seconds (0.64s).
[0m22:59:32.084375 [debug] [MainThread]: Command end result
[0m22:59:32.093079 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m22:59:32.093781 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m22:59:32.095982 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/run_results.json
[0m22:59:32.096103 [info ] [MainThread]: 
[0m22:59:32.096238 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:59:32.096342 [info ] [MainThread]: 
[0m22:59:32.096459 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m22:59:32.097971 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 1.9712464, "process_in_blocks": "0", "process_kernel_time": 0.162595, "process_mem_max_rss": "259686400", "process_out_blocks": "0", "process_user_time": 1.272998}
[0m22:59:32.098124 [debug] [MainThread]: Command `dbt build` succeeded at 22:59:32.098094 after 1.97 seconds
[0m22:59:32.098245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d8194f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7fc710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10db61750>]}
[0m22:59:32.098356 [debug] [MainThread]: Flushing usage events
[0m22:59:32.510901 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:00:17.998833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a844050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8ef9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8efb10>]}


============================== 23:00:18.001005 | 34107827-5b60-49a1-ab21-b3764496a952 ==============================
[0m23:00:18.001005 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:00:18.001264 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'invocation_command': 'dbt build --profiles-dir .', 'write_json': 'True', 'empty': 'False', 'debug': 'False', 'log_format': 'default', 'no_print': 'None', 'static_parser': 'True', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'warn_error': 'None', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True', 'fail_fast': 'False', 'log_path': '/Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/logs', 'quiet': 'False', 'profiles_dir': '.', 'target_path': 'None', 'cache_selected_only': 'False', 'partial_parse': 'True', 'log_cache_events': 'False'}
[0m23:00:18.081698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '34107827-5b60-49a1-ab21-b3764496a952', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac38b00>]}
[0m23:00:18.103301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '34107827-5b60-49a1-ab21-b3764496a952', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7ab9b0>]}
[0m23:00:18.104837 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m23:00:18.146273 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:00:18.185082 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:00:18.185365 [debug] [MainThread]: Partial parsing: updated file: dwd_weather://models/staging/stg_weather.sql
[0m23:00:18.267693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '34107827-5b60-49a1-ab21-b3764496a952', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9e2f50>]}
[0m23:00:18.288469 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:00:18.289387 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:00:18.326536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '34107827-5b60-49a1-ab21-b3764496a952', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf73c50>]}
[0m23:00:18.326767 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:00:18.327542 [info ] [MainThread]: 
[0m23:00:18.327674 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:00:18.327777 [info ] [MainThread]: 
[0m23:00:18.327962 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m23:00:18.329725 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_weather'
[0m23:00:18.352036 [debug] [ThreadPool]: Using duckdb connection "list_weather"
[0m23:00:18.352232 [debug] [ThreadPool]: On list_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"weather"'
    
  
  
[0m23:00:18.352346 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:00:18.357956 [debug] [ThreadPool]: SQL status: OK in 0.006 seconds
[0m23:00:18.358602 [debug] [ThreadPool]: On list_weather: Close
[0m23:00:18.358864 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_weather, now create_weather_main)
[0m23:00:18.359020 [debug] [ThreadPool]: Creating schema "database: "weather"
schema: "main"
"
[0m23:00:18.361432 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:00:18.361549 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='weather'
        and type='sqlite'
    
  
[0m23:00:18.361649 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:00:18.361909 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:00:18.362382 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:00:18.362478 [debug] [ThreadPool]: On create_weather_main: BEGIN
[0m23:00:18.362617 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:00:18.362707 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:00:18.362803 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
    
        create schema if not exists "weather"."main"
    
[0m23:00:18.362957 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:00:18.363257 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:00:18.363364 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:00:18.363449 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:00:18.363578 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:00:18.363676 [debug] [ThreadPool]: On create_weather_main: Close
[0m23:00:18.364056 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_weather_main, now list_weather_main)
[0m23:00:18.366024 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:00:18.366124 [debug] [ThreadPool]: On list_weather_main: BEGIN
[0m23:00:18.366207 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:00:18.366348 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:00:18.366440 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:00:18.366536 [debug] [ThreadPool]: On list_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather_main"} */
select
      'weather' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'weather'
  
[0m23:00:18.370271 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m23:00:18.370785 [debug] [ThreadPool]: On list_weather_main: ROLLBACK
[0m23:00:18.371517 [debug] [ThreadPool]: Failed to rollback 'list_weather_main'
[0m23:00:18.371645 [debug] [ThreadPool]: On list_weather_main: Close
[0m23:00:18.371963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '34107827-5b60-49a1-ab21-b3764496a952', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba8be70>]}
[0m23:00:18.372131 [debug] [MainThread]: Using duckdb connection "master"
[0m23:00:18.372227 [debug] [MainThread]: On master: BEGIN
[0m23:00:18.372316 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:00:18.372494 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:00:18.372587 [debug] [MainThread]: On master: COMMIT
[0m23:00:18.372678 [debug] [MainThread]: Using duckdb connection "master"
[0m23:00:18.372763 [debug] [MainThread]: On master: COMMIT
[0m23:00:18.373040 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:00:18.373137 [debug] [MainThread]: On master: Close
[0m23:00:18.374141 [debug] [Thread-1 (]: Began running node model.dwd_weather.stg_weather
[0m23:00:18.374320 [info ] [Thread-1 (]: 1 of 2 START sql view model main.stg_weather ................................... [RUN]
[0m23:00:18.374494 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_weather_main, now model.dwd_weather.stg_weather)
[0m23:00:18.374611 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.stg_weather
[0m23:00:18.376759 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.stg_weather"
[0m23:00:18.376996 [debug] [Thread-1 (]: Began executing node model.dwd_weather.stg_weather
[0m23:00:18.388856 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.stg_weather"
[0m23:00:18.389271 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:00:18.389417 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: BEGIN
[0m23:00:18.389538 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:00:18.389784 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:18.389897 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:00:18.390015 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

  
  create view "weather"."main"."stg_weather__dbt_tmp" as (
    with source as (
    select * from read_csv_auto('/Users/norangmangto/works/data_engineering/dwd_weather_prediction/data/raw/dwd_daily_01078.csv')
),

renamed as (
    select
        station_id,
        date::date as date,
        parameter,
        value,
        quality
    from source
)

select * from renamed
  );

[0m23:00:18.429529 [debug] [Thread-1 (]: SQL status: OK in 0.039 seconds
[0m23:00:18.432004 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:00:18.432156 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather" rename to "stg_weather__dbt_backup"
[0m23:00:18.432430 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:18.433521 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:00:18.433637 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather__dbt_tmp" rename to "stg_weather"
[0m23:00:18.433823 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:18.437956 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:00:18.438080 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:00:18.438186 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:00:18.438633 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:18.440556 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:00:18.440690 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

      drop view if exists "weather"."main"."stg_weather__dbt_backup" cascade
    
[0m23:00:18.440980 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:18.441882 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: Close
[0m23:00:18.442675 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34107827-5b60-49a1-ab21-b3764496a952', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c43e000>]}
[0m23:00:18.442911 [info ] [Thread-1 (]: 1 of 2 OK created sql view model main.stg_weather .............................. [[32mOK[0m in 0.07s]
[0m23:00:18.443126 [debug] [Thread-1 (]: Finished running node model.dwd_weather.stg_weather
[0m23:00:18.443440 [debug] [Thread-1 (]: Began running node model.dwd_weather.int_weather_features
[0m23:00:18.443617 [info ] [Thread-1 (]: 2 of 2 START sql view model main.int_weather_features .......................... [RUN]
[0m23:00:18.443771 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dwd_weather.stg_weather, now model.dwd_weather.int_weather_features)
[0m23:00:18.443900 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.int_weather_features
[0m23:00:18.444986 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.int_weather_features"
[0m23:00:18.445194 [debug] [Thread-1 (]: Began executing node model.dwd_weather.int_weather_features
[0m23:00:18.446160 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.int_weather_features"
[0m23:00:18.446361 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:00:18.446484 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: BEGIN
[0m23:00:18.446597 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:00:18.446799 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:18.446915 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:00:18.447067 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

  
  create view "weather"."main"."int_weather_features__dbt_tmp" as (
    with weather_data as (
    select * from "weather"."main"."stg_weather"
),

pivoted as (
    select
        date,
        max(case when parameter = 'temperature_air_mean_2m' then value end) as temp_mean,
        max(case when parameter = 'temperature_air_max_2m' then value end) as temp_max,
        max(case when parameter = 'temperature_air_min_2m' then value end) as temp_min,
        max(case when parameter = 'wind_speed' then value end) as wind_speed,
        max(case when parameter = 'precipitation_height' then value end) as precipitation,
        max(case when parameter = 'humidity' then value end) as humidity,
        max(case when parameter = 'sunshine_duration' then value end) as sunshine
    from weather_data
    group by date
),

cleaned as (
    select
        date,
        -- Simple interpolation or filling could be done here, but SQL window functions for interpolation are complex.
        -- We will assume data is mostly complete or handle nulls in training.
        -- For now, let's just use the values.
        temp_mean,
        temp_max,
        temp_min,
        wind_speed,
        coalesce(precipitation, 0) as precipitation, -- Assume 0 if null for precip
        humidity,
        sunshine,
        case when coalesce(precipitation, 0) > 0 then 1 else 0 end as is_raining
    from pivoted
),

features as (
    select
        *,
        -- Lag features (Past 1 day)
        lag(temp_mean, 1) over (order by date) as temp_mean_lag_1,
        lag(temp_max, 1) over (order by date) as temp_max_lag_1,
        lag(temp_min, 1) over (order by date) as temp_min_lag_1,
        lag(wind_speed, 1) over (order by date) as wind_speed_lag_1,
        lag(humidity, 1) over (order by date) as humidity_lag_1,
        lag(precipitation, 1) over (order by date) as precipitation_lag_1,

        -- Targets (Next 1 day)
        lead(temp_mean, 1) over (order by date) as target_temp_mean_day_1,
        lead(temp_max, 1) over (order by date) as target_temp_max_day_1,
        lead(temp_min, 1) over (order by date) as target_temp_min_day_1,
        lead(wind_speed, 1) over (order by date) as target_wind_speed_day_1,
        lead(humidity, 1) over (order by date) as target_humidity_day_1,
        lead(is_raining, 1) over (order by date) as target_is_raining_day_1
    from cleaned
)

select * from features
where date < current_date -- Filter out future empty rows if any
  );

[0m23:00:18.482176 [debug] [Thread-1 (]: SQL status: OK in 0.035 seconds
[0m23:00:18.483535 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:00:18.483674 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features" rename to "int_weather_features__dbt_backup"
[0m23:00:18.483955 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:18.484826 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:00:18.484951 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features__dbt_tmp" rename to "int_weather_features"
[0m23:00:18.485181 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:18.485672 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:00:18.485781 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:00:18.485880 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:00:18.486311 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:18.487078 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:00:18.487210 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

      drop view if exists "weather"."main"."int_weather_features__dbt_backup" cascade
    
[0m23:00:18.487468 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:18.487968 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: Close
[0m23:00:18.488179 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '34107827-5b60-49a1-ab21-b3764496a952', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c4204d0>]}
[0m23:00:18.488403 [info ] [Thread-1 (]: 2 of 2 OK created sql view model main.int_weather_features ..................... [[32mOK[0m in 0.04s]
[0m23:00:18.488604 [debug] [Thread-1 (]: Finished running node model.dwd_weather.int_weather_features
[0m23:00:18.489056 [debug] [MainThread]: Using duckdb connection "master"
[0m23:00:18.489154 [debug] [MainThread]: On master: BEGIN
[0m23:00:18.489239 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:00:18.489398 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:00:18.489488 [debug] [MainThread]: On master: COMMIT
[0m23:00:18.489569 [debug] [MainThread]: Using duckdb connection "master"
[0m23:00:18.489652 [debug] [MainThread]: On master: COMMIT
[0m23:00:18.489785 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:00:18.489880 [debug] [MainThread]: On master: Close
[0m23:00:18.489997 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:00:18.490094 [debug] [MainThread]: Connection 'model.dwd_weather.int_weather_features' was properly closed.
[0m23:00:18.490203 [info ] [MainThread]: 
[0m23:00:18.490315 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 0.16 seconds (0.16s).
[0m23:00:18.490597 [debug] [MainThread]: Command end result
[0m23:00:18.499028 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:00:18.499669 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:00:18.502000 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/run_results.json
[0m23:00:18.502134 [info ] [MainThread]: 
[0m23:00:18.502278 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:00:18.502387 [info ] [MainThread]: 
[0m23:00:18.502500 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m23:00:18.504004 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 0.5323621, "process_in_blocks": "0", "process_kernel_time": 0.124324, "process_mem_max_rss": "182845440", "process_out_blocks": "0", "process_user_time": 0.922227}
[0m23:00:18.504249 [debug] [MainThread]: Command `dbt build` succeeded at 23:00:18.504133 after 0.53 seconds
[0m23:00:18.504466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd93e30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c41e2b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c41e490>]}
[0m23:00:18.504616 [debug] [MainThread]: Flushing usage events
[0m23:00:18.945309 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:00:43.291344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108710050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097bb9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097bbb10>]}


============================== 23:00:43.293095 | b8d76316-3b6c-4d18-8dd2-5f4d8ad50939 ==============================
[0m23:00:43.293095 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:00:43.293366 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'introspect': 'True', 'warn_error': 'None', 'log_format': 'default', 'fail_fast': 'False', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'quiet': 'False', 'partial_parse': 'True', 'version_check': 'True', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'write_json': 'True', 'cache_selected_only': 'False', 'no_print': 'None', 'profiles_dir': '.', 'invocation_command': 'dbt build --profiles-dir .', 'empty': 'False', 'target_path': 'None', 'log_path': '/Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/logs'}
[0m23:00:43.370726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b8d76316-3b6c-4d18-8dd2-5f4d8ad50939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b18b00>]}
[0m23:00:43.392315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b8d76316-3b6c-4d18-8dd2-5f4d8ad50939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096779b0>]}
[0m23:00:43.392989 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m23:00:43.427341 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:00:43.458294 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:00:43.458450 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:00:43.468040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b8d76316-3b6c-4d18-8dd2-5f4d8ad50939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098af350>]}
[0m23:00:43.487901 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:00:43.488602 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:00:43.498107 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b8d76316-3b6c-4d18-8dd2-5f4d8ad50939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109dbd8b0>]}
[0m23:00:43.498295 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:00:43.499120 [info ] [MainThread]: 
[0m23:00:43.499264 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:00:43.499364 [info ] [MainThread]: 
[0m23:00:43.499547 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m23:00:43.501249 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_weather'
[0m23:00:43.521892 [debug] [ThreadPool]: Using duckdb connection "list_weather"
[0m23:00:43.522030 [debug] [ThreadPool]: On list_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"weather"'
    
  
  
[0m23:00:43.522132 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:00:43.526530 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m23:00:43.526985 [debug] [ThreadPool]: On list_weather: Close
[0m23:00:43.527208 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_weather, now create_weather_main)
[0m23:00:43.527356 [debug] [ThreadPool]: Creating schema "database: "weather"
schema: "main"
"
[0m23:00:43.529606 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:00:43.529710 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='weather'
        and type='sqlite'
    
  
[0m23:00:43.529798 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:00:43.530047 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:00:43.530469 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:00:43.530558 [debug] [ThreadPool]: On create_weather_main: BEGIN
[0m23:00:43.530704 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:00:43.530790 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:00:43.530877 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
    
        create schema if not exists "weather"."main"
    
[0m23:00:43.531030 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:00:43.531294 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:00:43.531386 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:00:43.531468 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:00:43.531599 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:00:43.531688 [debug] [ThreadPool]: On create_weather_main: Close
[0m23:00:43.532057 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_weather_main, now list_weather_main)
[0m23:00:43.535187 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:00:43.535295 [debug] [ThreadPool]: On list_weather_main: BEGIN
[0m23:00:43.535379 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:00:43.535535 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:00:43.535622 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:00:43.535711 [debug] [ThreadPool]: On list_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather_main"} */
select
      'weather' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'weather'
  
[0m23:00:43.539329 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m23:00:43.539774 [debug] [ThreadPool]: On list_weather_main: ROLLBACK
[0m23:00:43.540191 [debug] [ThreadPool]: Failed to rollback 'list_weather_main'
[0m23:00:43.540284 [debug] [ThreadPool]: On list_weather_main: Close
[0m23:00:43.540585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b8d76316-3b6c-4d18-8dd2-5f4d8ad50939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109dfa430>]}
[0m23:00:43.540732 [debug] [MainThread]: Using duckdb connection "master"
[0m23:00:43.540818 [debug] [MainThread]: On master: BEGIN
[0m23:00:43.540900 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:00:43.541047 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:00:43.541132 [debug] [MainThread]: On master: COMMIT
[0m23:00:43.541213 [debug] [MainThread]: Using duckdb connection "master"
[0m23:00:43.541292 [debug] [MainThread]: On master: COMMIT
[0m23:00:43.541441 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:00:43.541544 [debug] [MainThread]: On master: Close
[0m23:00:43.542220 [debug] [Thread-1 (]: Began running node model.dwd_weather.stg_weather
[0m23:00:43.542384 [info ] [Thread-1 (]: 1 of 2 START sql view model main.stg_weather ................................... [RUN]
[0m23:00:43.542551 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_weather_main, now model.dwd_weather.stg_weather)
[0m23:00:43.542667 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.stg_weather
[0m23:00:43.544798 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.stg_weather"
[0m23:00:43.545031 [debug] [Thread-1 (]: Began executing node model.dwd_weather.stg_weather
[0m23:00:43.578082 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.stg_weather"
[0m23:00:43.578474 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:00:43.578597 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: BEGIN
[0m23:00:43.578712 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:00:43.578976 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:43.579081 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:00:43.579192 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

  
  create view "weather"."main"."stg_weather__dbt_tmp" as (
    with source as (
    select * from read_csv_auto('/Users/norangmangto/works/data_engineering/dwd_weather_prediction/data/raw/dwd_daily_01078.csv')
),

renamed as (
    select
        station_id,
        date::date as date,
        parameter,
        value,
        quality
    from source
)

select * from renamed
  );

[0m23:00:43.614693 [debug] [Thread-1 (]: SQL status: OK in 0.035 seconds
[0m23:00:43.617081 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:00:43.617206 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather" rename to "stg_weather__dbt_backup"
[0m23:00:43.617436 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:43.618489 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:00:43.618615 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather__dbt_tmp" rename to "stg_weather"
[0m23:00:43.618811 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:43.623082 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:00:43.623217 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:00:43.623320 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:00:43.623724 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:43.625459 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:00:43.625576 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

      drop view if exists "weather"."main"."stg_weather__dbt_backup" cascade
    
[0m23:00:43.625820 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:43.626649 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: Close
[0m23:00:43.627264 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8d76316-3b6c-4d18-8dd2-5f4d8ad50939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a12ad00>]}
[0m23:00:43.627487 [info ] [Thread-1 (]: 1 of 2 OK created sql view model main.stg_weather .............................. [[32mOK[0m in 0.08s]
[0m23:00:43.627698 [debug] [Thread-1 (]: Finished running node model.dwd_weather.stg_weather
[0m23:00:43.627998 [debug] [Thread-1 (]: Began running node model.dwd_weather.int_weather_features
[0m23:00:43.628175 [info ] [Thread-1 (]: 2 of 2 START sql view model main.int_weather_features .......................... [RUN]
[0m23:00:43.628326 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dwd_weather.stg_weather, now model.dwd_weather.int_weather_features)
[0m23:00:43.628454 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.int_weather_features
[0m23:00:43.629511 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.int_weather_features"
[0m23:00:43.629725 [debug] [Thread-1 (]: Began executing node model.dwd_weather.int_weather_features
[0m23:00:43.630718 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.int_weather_features"
[0m23:00:43.630919 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:00:43.631025 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: BEGIN
[0m23:00:43.631126 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:00:43.631317 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:43.631427 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:00:43.631589 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

  
  create view "weather"."main"."int_weather_features__dbt_tmp" as (
    with weather_data as (
    select * from "weather"."main"."stg_weather"
),

pivoted as (
    select
        date,
        max(case when parameter = 'temperature_air_mean_2m' then value end) as temp_mean,
        max(case when parameter = 'temperature_air_max_2m' then value end) as temp_max,
        max(case when parameter = 'temperature_air_min_2m' then value end) as temp_min,
        max(case when parameter = 'wind_speed' then value end) as wind_speed,
        max(case when parameter = 'precipitation_height' then value end) as precipitation,
        max(case when parameter = 'humidity' then value end) as humidity,
        max(case when parameter = 'sunshine_duration' then value end) as sunshine
    from weather_data
    group by date
),

cleaned as (
    select
        date,
        -- Simple interpolation or filling could be done here, but SQL window functions for interpolation are complex.
        -- We will assume data is mostly complete or handle nulls in training.
        -- For now, let's just use the values.
        temp_mean,
        temp_max,
        temp_min,
        wind_speed,
        coalesce(precipitation, 0) as precipitation, -- Assume 0 if null for precip
        humidity,
        sunshine,
        case when coalesce(precipitation, 0) > 0 then 1 else 0 end as is_raining
    from pivoted
),

features as (
    select
        *,
        -- Lag features (Past 1 day)
        lag(temp_mean, 1) over (order by date) as temp_mean_lag_1,
        lag(temp_max, 1) over (order by date) as temp_max_lag_1,
        lag(temp_min, 1) over (order by date) as temp_min_lag_1,
        lag(wind_speed, 1) over (order by date) as wind_speed_lag_1,
        lag(humidity, 1) over (order by date) as humidity_lag_1,
        lag(precipitation, 1) over (order by date) as precipitation_lag_1,

        -- Targets (Next 1 day)
        lead(temp_mean, 1) over (order by date) as target_temp_mean_day_1,
        lead(temp_max, 1) over (order by date) as target_temp_max_day_1,
        lead(temp_min, 1) over (order by date) as target_temp_min_day_1,
        lead(wind_speed, 1) over (order by date) as target_wind_speed_day_1,
        lead(humidity, 1) over (order by date) as target_humidity_day_1,
        lead(is_raining, 1) over (order by date) as target_is_raining_day_1
    from cleaned
)

select * from features
where date < current_date -- Filter out future empty rows if any
  );

[0m23:00:43.665880 [debug] [Thread-1 (]: SQL status: OK in 0.034 seconds
[0m23:00:43.667191 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:00:43.667319 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features" rename to "int_weather_features__dbt_backup"
[0m23:00:43.667572 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:43.668411 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:00:43.668519 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features__dbt_tmp" rename to "int_weather_features"
[0m23:00:43.668732 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:43.669203 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:00:43.669316 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:00:43.669417 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:00:43.669822 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:43.670561 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:00:43.670686 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

      drop view if exists "weather"."main"."int_weather_features__dbt_backup" cascade
    
[0m23:00:43.670948 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:00:43.671530 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: Close
[0m23:00:43.671727 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b8d76316-3b6c-4d18-8dd2-5f4d8ad50939', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ddd610>]}
[0m23:00:43.671947 [info ] [Thread-1 (]: 2 of 2 OK created sql view model main.int_weather_features ..................... [[32mOK[0m in 0.04s]
[0m23:00:43.672154 [debug] [Thread-1 (]: Finished running node model.dwd_weather.int_weather_features
[0m23:00:43.672588 [debug] [MainThread]: Using duckdb connection "master"
[0m23:00:43.672697 [debug] [MainThread]: On master: BEGIN
[0m23:00:43.672790 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:00:43.672952 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:00:43.673048 [debug] [MainThread]: On master: COMMIT
[0m23:00:43.673141 [debug] [MainThread]: Using duckdb connection "master"
[0m23:00:43.673234 [debug] [MainThread]: On master: COMMIT
[0m23:00:43.673390 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:00:43.673501 [debug] [MainThread]: On master: Close
[0m23:00:43.673631 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:00:43.673724 [debug] [MainThread]: Connection 'model.dwd_weather.int_weather_features' was properly closed.
[0m23:00:43.673833 [info ] [MainThread]: 
[0m23:00:43.673946 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 0.17 seconds (0.17s).
[0m23:00:43.674226 [debug] [MainThread]: Command end result
[0m23:00:43.681061 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:00:43.681667 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:00:43.683803 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/run_results.json
[0m23:00:43.683903 [info ] [MainThread]: 
[0m23:00:43.684031 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:00:43.684135 [info ] [MainThread]: 
[0m23:00:43.684254 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m23:00:43.685242 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 0.41898575, "process_in_blocks": "0", "process_kernel_time": 0.111553, "process_mem_max_rss": "179830784", "process_out_blocks": "0", "process_user_time": 0.822116}
[0m23:00:43.685394 [debug] [MainThread]: Command `dbt build` succeeded at 23:00:43.685363 after 0.42 seconds
[0m23:00:43.685513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e35d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109eb6a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109eb6e90>]}
[0m23:00:43.685626 [debug] [MainThread]: Flushing usage events
[0m23:00:44.138582 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:11:43.768126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a254050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b2ff9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b2ffb10>]}


============================== 23:11:43.770376 | 36da6614-16ad-4dff-b9a2-5c02c3062a93 ==============================
[0m23:11:43.770376 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:11:43.770637 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'fail_fast': 'False', 'invocation_command': 'dbt build --profiles-dir .', 'partial_parse': 'True', 'warn_error': 'None', 'introspect': 'True', 'no_print': 'None', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'log_format': 'default', 'write_json': 'True', 'debug': 'False', 'profiles_dir': '.', 'use_colors': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'empty': 'False', 'quiet': 'False', 'log_path': '/Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/logs', 'printer_width': '80', 'use_experimental_parser': 'False'}
[0m23:11:43.907366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '36da6614-16ad-4dff-b9a2-5c02c3062a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a65cb00>]}
[0m23:11:43.929000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '36da6614-16ad-4dff-b9a2-5c02c3062a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b1b79b0>]}
[0m23:11:43.930123 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m23:11:43.968997 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:11:44.009442 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:11:44.009612 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:11:44.019369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '36da6614-16ad-4dff-b9a2-5c02c3062a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3f3350>]}
[0m23:11:44.039619 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:11:44.040495 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:11:44.056314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '36da6614-16ad-4dff-b9a2-5c02c3062a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9018b0>]}
[0m23:11:44.056553 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:11:44.057462 [info ] [MainThread]: 
[0m23:11:44.057606 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:11:44.057713 [info ] [MainThread]: 
[0m23:11:44.057914 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m23:11:44.059625 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_weather'
[0m23:11:44.084931 [debug] [ThreadPool]: Using duckdb connection "list_weather"
[0m23:11:44.085098 [debug] [ThreadPool]: On list_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"weather"'
    
  
  
[0m23:11:44.085204 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:11:44.096366 [debug] [ThreadPool]: SQL status: OK in 0.011 seconds
[0m23:11:44.096891 [debug] [ThreadPool]: On list_weather: Close
[0m23:11:44.097124 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_weather, now create_weather_main)
[0m23:11:44.097275 [debug] [ThreadPool]: Creating schema "database: "weather"
schema: "main"
"
[0m23:11:44.099629 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:11:44.099738 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='weather'
        and type='sqlite'
    
  
[0m23:11:44.099827 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:11:44.100307 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:11:44.100794 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:11:44.100898 [debug] [ThreadPool]: On create_weather_main: BEGIN
[0m23:11:44.101047 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:11:44.101154 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:11:44.101250 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
    
        create schema if not exists "weather"."main"
    
[0m23:11:44.101455 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:11:44.101768 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:11:44.101866 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:11:44.101951 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:11:44.102109 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:11:44.102237 [debug] [ThreadPool]: On create_weather_main: Close
[0m23:11:44.102662 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_weather_main, now list_weather_main)
[0m23:11:44.105970 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:11:44.106085 [debug] [ThreadPool]: On list_weather_main: BEGIN
[0m23:11:44.106173 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:11:44.106354 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:11:44.106451 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:11:44.106550 [debug] [ThreadPool]: On list_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather_main"} */
select
      'weather' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'weather'
  
[0m23:11:44.112165 [debug] [ThreadPool]: SQL status: OK in 0.006 seconds
[0m23:11:44.112800 [debug] [ThreadPool]: On list_weather_main: ROLLBACK
[0m23:11:44.113492 [debug] [ThreadPool]: Failed to rollback 'list_weather_main'
[0m23:11:44.113606 [debug] [ThreadPool]: On list_weather_main: Close
[0m23:11:44.113912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '36da6614-16ad-4dff-b9a2-5c02c3062a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b93a430>]}
[0m23:11:44.114067 [debug] [MainThread]: Using duckdb connection "master"
[0m23:11:44.114167 [debug] [MainThread]: On master: BEGIN
[0m23:11:44.114263 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:11:44.114458 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:11:44.114558 [debug] [MainThread]: On master: COMMIT
[0m23:11:44.114654 [debug] [MainThread]: Using duckdb connection "master"
[0m23:11:44.114748 [debug] [MainThread]: On master: COMMIT
[0m23:11:44.114886 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:11:44.114980 [debug] [MainThread]: On master: Close
[0m23:11:44.115944 [debug] [Thread-1 (]: Began running node model.dwd_weather.stg_weather
[0m23:11:44.116135 [info ] [Thread-1 (]: 1 of 2 START sql view model main.stg_weather ................................... [RUN]
[0m23:11:44.116310 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_weather_main, now model.dwd_weather.stg_weather)
[0m23:11:44.116443 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.stg_weather
[0m23:11:44.118656 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.stg_weather"
[0m23:11:44.118899 [debug] [Thread-1 (]: Began executing node model.dwd_weather.stg_weather
[0m23:11:44.157748 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.stg_weather"
[0m23:11:44.158131 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:11:44.158253 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: BEGIN
[0m23:11:44.158359 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:11:44.158622 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:11:44.158727 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:11:44.158833 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

  
  create view "weather"."main"."stg_weather__dbt_tmp" as (
    with source as (
    select * from read_csv_auto('/Users/norangmangto/works/data_engineering/dwd_weather_prediction/data/raw/dwd_daily_01078.csv')
),

renamed as (
    select
        station_id,
        date::date as date,
        parameter,
        value,
        quality
    from source
)

select * from renamed
  );

[0m23:11:44.196910 [debug] [Thread-1 (]: SQL status: OK in 0.038 seconds
[0m23:11:44.199577 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:11:44.199749 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather" rename to "stg_weather__dbt_backup"
[0m23:11:44.200433 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m23:11:44.201803 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:11:44.201979 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather__dbt_tmp" rename to "stg_weather"
[0m23:11:44.202258 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:11:44.206517 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:11:44.206645 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:11:44.206754 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:11:44.207176 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:11:44.208931 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:11:44.209044 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

      drop view if exists "weather"."main"."stg_weather__dbt_backup" cascade
    
[0m23:11:44.209269 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:11:44.210137 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: Close
[0m23:11:44.210907 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '36da6614-16ad-4dff-b9a2-5c02c3062a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc6ed00>]}
[0m23:11:44.211156 [info ] [Thread-1 (]: 1 of 2 OK created sql view model main.stg_weather .............................. [[32mOK[0m in 0.09s]
[0m23:11:44.211375 [debug] [Thread-1 (]: Finished running node model.dwd_weather.stg_weather
[0m23:11:44.211651 [debug] [Thread-1 (]: Began running node model.dwd_weather.int_weather_features
[0m23:11:44.211843 [info ] [Thread-1 (]: 2 of 2 START sql view model main.int_weather_features .......................... [RUN]
[0m23:11:44.212031 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dwd_weather.stg_weather, now model.dwd_weather.int_weather_features)
[0m23:11:44.212171 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.int_weather_features
[0m23:11:44.213305 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.int_weather_features"
[0m23:11:44.213550 [debug] [Thread-1 (]: Began executing node model.dwd_weather.int_weather_features
[0m23:11:44.214559 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.int_weather_features"
[0m23:11:44.214776 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:11:44.214888 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: BEGIN
[0m23:11:44.214990 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:11:44.215187 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:11:44.215305 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:11:44.215467 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

  
  create view "weather"."main"."int_weather_features__dbt_tmp" as (
    with weather_data as (
    select * from "weather"."main"."stg_weather"
),

pivoted as (
    select
        date,
        max(case when parameter = 'temperature_air_mean_2m' then value end) as temp_mean,
        max(case when parameter = 'temperature_air_max_2m' then value end) as temp_max,
        max(case when parameter = 'temperature_air_min_2m' then value end) as temp_min,
        max(case when parameter = 'wind_speed' then value end) as wind_speed,
        max(case when parameter = 'precipitation_height' then value end) as precipitation,
        max(case when parameter = 'humidity' then value end) as humidity,
        max(case when parameter = 'sunshine_duration' then value end) as sunshine
    from weather_data
    group by date
),

cleaned as (
    select
        date,
        -- Simple interpolation or filling could be done here, but SQL window functions for interpolation are complex.
        -- We will assume data is mostly complete or handle nulls in training.
        -- For now, let's just use the values.
        temp_mean,
        temp_max,
        temp_min,
        wind_speed,
        coalesce(precipitation, 0) as precipitation, -- Assume 0 if null for precip
        humidity,
        sunshine,
        case when coalesce(precipitation, 0) > 0 then 1 else 0 end as is_raining
    from pivoted
),

features as (
    select
        *,
        -- Lag features (Past 1 day)
        lag(temp_mean, 1) over (order by date) as temp_mean_lag_1,
        lag(temp_max, 1) over (order by date) as temp_max_lag_1,
        lag(temp_min, 1) over (order by date) as temp_min_lag_1,
        lag(wind_speed, 1) over (order by date) as wind_speed_lag_1,
        lag(humidity, 1) over (order by date) as humidity_lag_1,
        lag(precipitation, 1) over (order by date) as precipitation_lag_1,

        -- Targets (Next 1 day)
        lead(temp_mean, 1) over (order by date) as target_temp_mean_day_1,
        lead(temp_max, 1) over (order by date) as target_temp_max_day_1,
        lead(temp_min, 1) over (order by date) as target_temp_min_day_1,
        lead(wind_speed, 1) over (order by date) as target_wind_speed_day_1,
        lead(humidity, 1) over (order by date) as target_humidity_day_1,
        lead(is_raining, 1) over (order by date) as target_is_raining_day_1
    from cleaned
)

select * from features
where date < current_date -- Filter out future empty rows if any
  );

[0m23:11:44.251225 [debug] [Thread-1 (]: SQL status: OK in 0.036 seconds
[0m23:11:44.252570 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:11:44.252704 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features" rename to "int_weather_features__dbt_backup"
[0m23:11:44.252978 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:11:44.253882 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:11:44.253997 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features__dbt_tmp" rename to "int_weather_features"
[0m23:11:44.254224 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:11:44.254749 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:11:44.254858 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:11:44.254961 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:11:44.255329 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:11:44.256024 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:11:44.256134 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

      drop view if exists "weather"."main"."int_weather_features__dbt_backup" cascade
    
[0m23:11:44.256360 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:11:44.256943 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: Close
[0m23:11:44.257142 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '36da6614-16ad-4dff-b9a2-5c02c3062a93', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8e5910>]}
[0m23:11:44.257362 [info ] [Thread-1 (]: 2 of 2 OK created sql view model main.int_weather_features ..................... [[32mOK[0m in 0.05s]
[0m23:11:44.257571 [debug] [Thread-1 (]: Finished running node model.dwd_weather.int_weather_features
[0m23:11:44.258027 [debug] [MainThread]: Using duckdb connection "master"
[0m23:11:44.258138 [debug] [MainThread]: On master: BEGIN
[0m23:11:44.258237 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:11:44.258393 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:11:44.258491 [debug] [MainThread]: On master: COMMIT
[0m23:11:44.258586 [debug] [MainThread]: Using duckdb connection "master"
[0m23:11:44.258681 [debug] [MainThread]: On master: COMMIT
[0m23:11:44.258852 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:11:44.259007 [debug] [MainThread]: On master: Close
[0m23:11:44.259167 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:11:44.259268 [debug] [MainThread]: Connection 'model.dwd_weather.int_weather_features' was properly closed.
[0m23:11:44.259383 [info ] [MainThread]: 
[0m23:11:44.259503 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m23:11:44.259792 [debug] [MainThread]: Command end result
[0m23:11:44.266791 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:11:44.267486 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:11:44.269673 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/run_results.json
[0m23:11:44.269786 [info ] [MainThread]: 
[0m23:11:44.269924 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:11:44.270032 [info ] [MainThread]: 
[0m23:11:44.270149 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m23:11:44.271151 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 0.53076905, "process_in_blocks": "0", "process_kernel_time": 0.14125, "process_mem_max_rss": "180486144", "process_out_blocks": "0", "process_user_time": 0.849939}
[0m23:11:44.271306 [debug] [MainThread]: Command `dbt build` succeeded at 23:11:44.271274 after 0.53 seconds
[0m23:11:44.271434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b979d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9f6a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b9f6e90>]}
[0m23:11:44.271550 [debug] [MainThread]: Flushing usage events
[0m23:11:44.731454 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:11:58.257016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108314050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093bf9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093bfb10>]}


============================== 23:11:58.258716 | d587a55c-c7f3-4a0f-85a6-c8653dee4634 ==============================
[0m23:11:58.258716 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:11:58.258971 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'introspect': 'True', 'use_colors': 'True', 'invocation_command': 'dbt build --profiles-dir .', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'debug': 'False', 'quiet': 'False', 'printer_width': '80', 'write_json': 'True', 'version_check': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'profiles_dir': '.', 'warn_error': 'None', 'indirect_selection': 'eager', 'target_path': 'None', 'fail_fast': 'False', 'log_path': '/Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/logs', 'log_format': 'default'}
[0m23:11:58.335688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd587a55c-c7f3-4a0f-85a6-c8653dee4634', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10871cb00>]}
[0m23:11:58.358373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd587a55c-c7f3-4a0f-85a6-c8653dee4634', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10927b9b0>]}
[0m23:11:58.359225 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m23:11:58.395192 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:11:58.426537 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:11:58.426696 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:11:58.436867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd587a55c-c7f3-4a0f-85a6-c8653dee4634', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094b3350>]}
[0m23:11:58.457626 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:11:58.458438 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:11:58.468088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd587a55c-c7f3-4a0f-85a6-c8653dee4634', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099c18b0>]}
[0m23:11:58.468285 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:11:58.469174 [info ] [MainThread]: 
[0m23:11:58.469311 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:11:58.469417 [info ] [MainThread]: 
[0m23:11:58.469611 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m23:11:58.471306 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_weather'
[0m23:11:58.489775 [debug] [ThreadPool]: Using duckdb connection "list_weather"
[0m23:11:58.489942 [debug] [ThreadPool]: On list_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"weather"'
    
  
  
[0m23:11:58.490054 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:11:58.494635 [debug] [ThreadPool]: SQL status: OK in 0.005 seconds
[0m23:11:58.495134 [debug] [ThreadPool]: On list_weather: Close
[0m23:11:58.495377 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_weather, now create_weather_main)
[0m23:11:58.495534 [debug] [ThreadPool]: Creating schema "database: "weather"
schema: "main"
"
[0m23:11:58.497875 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:11:58.497989 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='weather'
        and type='sqlite'
    
  
[0m23:11:58.498080 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:11:58.498339 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:11:58.498769 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:11:58.498862 [debug] [ThreadPool]: On create_weather_main: BEGIN
[0m23:11:58.499053 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:11:58.499173 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:11:58.499271 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
    
        create schema if not exists "weather"."main"
    
[0m23:11:58.499443 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:11:58.499748 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:11:58.499845 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:11:58.499950 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:11:58.500112 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:11:58.500205 [debug] [ThreadPool]: On create_weather_main: Close
[0m23:11:58.500607 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_weather_main, now list_weather_main)
[0m23:11:58.503887 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:11:58.504008 [debug] [ThreadPool]: On list_weather_main: BEGIN
[0m23:11:58.504098 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:11:58.504284 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:11:58.504373 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:11:58.504462 [debug] [ThreadPool]: On list_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather_main"} */
select
      'weather' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'weather'
  
[0m23:11:58.508113 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m23:11:58.508574 [debug] [ThreadPool]: On list_weather_main: ROLLBACK
[0m23:11:58.508958 [debug] [ThreadPool]: Failed to rollback 'list_weather_main'
[0m23:11:58.509052 [debug] [ThreadPool]: On list_weather_main: Close
[0m23:11:58.509351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd587a55c-c7f3-4a0f-85a6-c8653dee4634', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099fe430>]}
[0m23:11:58.509497 [debug] [MainThread]: Using duckdb connection "master"
[0m23:11:58.509587 [debug] [MainThread]: On master: BEGIN
[0m23:11:58.509669 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:11:58.509823 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:11:58.509908 [debug] [MainThread]: On master: COMMIT
[0m23:11:58.509991 [debug] [MainThread]: Using duckdb connection "master"
[0m23:11:58.510071 [debug] [MainThread]: On master: COMMIT
[0m23:11:58.510229 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:11:58.510347 [debug] [MainThread]: On master: Close
[0m23:11:58.511042 [debug] [Thread-1 (]: Began running node model.dwd_weather.stg_weather
[0m23:11:58.511215 [info ] [Thread-1 (]: 1 of 2 START sql view model main.stg_weather ................................... [RUN]
[0m23:11:58.511380 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_weather_main, now model.dwd_weather.stg_weather)
[0m23:11:58.511506 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.stg_weather
[0m23:11:58.513645 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.stg_weather"
[0m23:11:58.513904 [debug] [Thread-1 (]: Began executing node model.dwd_weather.stg_weather
[0m23:11:58.548067 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.stg_weather"
[0m23:11:58.548461 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:11:58.548588 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: BEGIN
[0m23:11:58.548694 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:11:58.548942 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:11:58.549124 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:11:58.549289 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

  
  create view "weather"."main"."stg_weather__dbt_tmp" as (
    with source as (
    select * from read_csv_auto('/Users/norangmangto/works/data_engineering/dwd_weather_prediction/data/raw/dwd_daily_01078.csv')
),

renamed as (
    select
        station_id,
        date::date as date,
        parameter,
        value,
        quality
    from source
)

select * from renamed
  );

[0m23:11:58.585606 [debug] [Thread-1 (]: SQL status: OK in 0.036 seconds
[0m23:11:58.588309 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:11:58.588474 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather" rename to "stg_weather__dbt_backup"
[0m23:11:58.588764 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:11:58.589884 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:11:58.589997 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather__dbt_tmp" rename to "stg_weather"
[0m23:11:58.590206 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:11:58.594321 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:11:58.594446 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:11:58.594552 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:11:58.594985 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:11:58.596695 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:11:58.596811 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

      drop view if exists "weather"."main"."stg_weather__dbt_backup" cascade
    
[0m23:11:58.597040 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:11:58.597890 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: Close
[0m23:11:58.598502 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd587a55c-c7f3-4a0f-85a6-c8653dee4634', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d9ad00>]}
[0m23:11:58.598719 [info ] [Thread-1 (]: 1 of 2 OK created sql view model main.stg_weather .............................. [[32mOK[0m in 0.09s]
[0m23:11:58.598927 [debug] [Thread-1 (]: Finished running node model.dwd_weather.stg_weather
[0m23:11:58.599256 [debug] [Thread-1 (]: Began running node model.dwd_weather.int_weather_features
[0m23:11:58.599435 [info ] [Thread-1 (]: 2 of 2 START sql view model main.int_weather_features .......................... [RUN]
[0m23:11:58.599662 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dwd_weather.stg_weather, now model.dwd_weather.int_weather_features)
[0m23:11:58.599824 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.int_weather_features
[0m23:11:58.601123 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.int_weather_features"
[0m23:11:58.601506 [debug] [Thread-1 (]: Began executing node model.dwd_weather.int_weather_features
[0m23:11:58.602727 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.int_weather_features"
[0m23:11:58.602960 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:11:58.603075 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: BEGIN
[0m23:11:58.603180 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:11:58.603419 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:11:58.603534 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:11:58.603694 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

  
  create view "weather"."main"."int_weather_features__dbt_tmp" as (
    with weather_data as (
    select * from "weather"."main"."stg_weather"
),

pivoted as (
    select
        date,
        max(case when parameter = 'temperature_air_mean_2m' then value end) as temp_mean,
        max(case when parameter = 'temperature_air_max_2m' then value end) as temp_max,
        max(case when parameter = 'temperature_air_min_2m' then value end) as temp_min,
        max(case when parameter = 'wind_speed' then value end) as wind_speed,
        max(case when parameter = 'precipitation_height' then value end) as precipitation,
        max(case when parameter = 'humidity' then value end) as humidity,
        max(case when parameter = 'sunshine_duration' then value end) as sunshine
    from weather_data
    group by date
),

cleaned as (
    select
        date,
        -- Simple interpolation or filling could be done here, but SQL window functions for interpolation are complex.
        -- We will assume data is mostly complete or handle nulls in training.
        -- For now, let's just use the values.
        temp_mean,
        temp_max,
        temp_min,
        wind_speed,
        coalesce(precipitation, 0) as precipitation, -- Assume 0 if null for precip
        humidity,
        sunshine,
        case when coalesce(precipitation, 0) > 0 then 1 else 0 end as is_raining
    from pivoted
),

features as (
    select
        *,
        -- Lag features (Past 1 day)
        lag(temp_mean, 1) over (order by date) as temp_mean_lag_1,
        lag(temp_max, 1) over (order by date) as temp_max_lag_1,
        lag(temp_min, 1) over (order by date) as temp_min_lag_1,
        lag(wind_speed, 1) over (order by date) as wind_speed_lag_1,
        lag(humidity, 1) over (order by date) as humidity_lag_1,
        lag(precipitation, 1) over (order by date) as precipitation_lag_1,

        -- Targets (Next 1 day)
        lead(temp_mean, 1) over (order by date) as target_temp_mean_day_1,
        lead(temp_max, 1) over (order by date) as target_temp_max_day_1,
        lead(temp_min, 1) over (order by date) as target_temp_min_day_1,
        lead(wind_speed, 1) over (order by date) as target_wind_speed_day_1,
        lead(humidity, 1) over (order by date) as target_humidity_day_1,
        lead(is_raining, 1) over (order by date) as target_is_raining_day_1
    from cleaned
)

select * from features
where date < current_date -- Filter out future empty rows if any
  );

[0m23:11:58.639508 [debug] [Thread-1 (]: SQL status: OK in 0.036 seconds
[0m23:11:58.645278 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:11:58.645703 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features" rename to "int_weather_features__dbt_backup"
[0m23:11:58.646436 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:11:58.649052 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:11:58.649330 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features__dbt_tmp" rename to "int_weather_features"
[0m23:11:58.649720 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:11:58.650696 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:11:58.651045 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:11:58.651318 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:11:58.652227 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m23:11:58.653241 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:11:58.653389 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

      drop view if exists "weather"."main"."int_weather_features__dbt_backup" cascade
    
[0m23:11:58.653776 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:11:58.654612 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: Close
[0m23:11:58.654861 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd587a55c-c7f3-4a0f-85a6-c8653dee4634', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10999d610>]}
[0m23:11:58.655127 [info ] [Thread-1 (]: 2 of 2 OK created sql view model main.int_weather_features ..................... [[32mOK[0m in 0.06s]
[0m23:11:58.655823 [debug] [Thread-1 (]: Finished running node model.dwd_weather.int_weather_features
[0m23:11:58.656718 [debug] [MainThread]: Using duckdb connection "master"
[0m23:11:58.656862 [debug] [MainThread]: On master: BEGIN
[0m23:11:58.656967 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:11:58.657199 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:11:58.657298 [debug] [MainThread]: On master: COMMIT
[0m23:11:58.657397 [debug] [MainThread]: Using duckdb connection "master"
[0m23:11:58.657488 [debug] [MainThread]: On master: COMMIT
[0m23:11:58.657640 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:11:58.657738 [debug] [MainThread]: On master: Close
[0m23:11:58.657870 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:11:58.657964 [debug] [MainThread]: Connection 'model.dwd_weather.int_weather_features' was properly closed.
[0m23:11:58.658099 [info ] [MainThread]: 
[0m23:11:58.658391 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 0.19 seconds (0.19s).
[0m23:11:58.659170 [debug] [MainThread]: Command end result
[0m23:11:58.672010 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:11:58.673875 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:11:58.678451 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/run_results.json
[0m23:11:58.678623 [info ] [MainThread]: 
[0m23:11:58.678768 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:11:58.678871 [info ] [MainThread]: 
[0m23:11:58.678987 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m23:11:58.679987 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 0.44826403, "process_in_blocks": "0", "process_kernel_time": 0.111592, "process_mem_max_rss": "180371456", "process_out_blocks": "0", "process_user_time": 0.849937}
[0m23:11:58.680145 [debug] [MainThread]: Command `dbt build` succeeded at 23:11:58.680114 after 0.45 seconds
[0m23:11:58.680267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a39d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109abaa30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109abaad0>]}
[0m23:11:58.680390 [debug] [MainThread]: Flushing usage events
[0m23:11:59.104805 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:12:12.449263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c104050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d1af9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d1afb10>]}


============================== 23:12:12.451130 | 98bf7bdd-4873-491d-b2ff-075b47bd2753 ==============================
[0m23:12:12.451130 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:12:12.451389 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'log_format': 'default', 'warn_error': 'None', 'version_check': 'True', 'no_print': 'None', 'target_path': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'introspect': 'True', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'invocation_command': 'dbt build --profiles-dir .', 'partial_parse': 'True', 'log_path': '/Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/logs', 'debug': 'False', 'use_colors': 'True', 'write_json': 'True', 'static_parser': 'True', 'profiles_dir': '.', 'empty': 'False'}
[0m23:12:12.527769 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '98bf7bdd-4873-491d-b2ff-075b47bd2753', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c508b00>]}
[0m23:12:12.551202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '98bf7bdd-4873-491d-b2ff-075b47bd2753', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0679b0>]}
[0m23:12:12.552350 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m23:12:12.587886 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:12:12.619324 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:12:12.619492 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:12:12.629299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '98bf7bdd-4873-491d-b2ff-075b47bd2753', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d2a3350>]}
[0m23:12:12.650253 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:12:12.651270 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:12:12.661409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '98bf7bdd-4873-491d-b2ff-075b47bd2753', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7b18b0>]}
[0m23:12:12.661605 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:12:12.662492 [info ] [MainThread]: 
[0m23:12:12.662637 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:12:12.662742 [info ] [MainThread]: 
[0m23:12:12.662946 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m23:12:12.664688 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_weather'
[0m23:12:12.683680 [debug] [ThreadPool]: Using duckdb connection "list_weather"
[0m23:12:12.683837 [debug] [ThreadPool]: On list_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"weather"'
    
  
  
[0m23:12:12.683940 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:12:12.688479 [debug] [ThreadPool]: SQL status: OK in 0.005 seconds
[0m23:12:12.688964 [debug] [ThreadPool]: On list_weather: Close
[0m23:12:12.689199 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_weather, now create_weather_main)
[0m23:12:12.689352 [debug] [ThreadPool]: Creating schema "database: "weather"
schema: "main"
"
[0m23:12:12.691677 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:12:12.691794 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='weather'
        and type='sqlite'
    
  
[0m23:12:12.691884 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:12.692145 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:12.692578 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:12:12.692673 [debug] [ThreadPool]: On create_weather_main: BEGIN
[0m23:12:12.692810 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:12.692893 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:12:12.692976 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
    
        create schema if not exists "weather"."main"
    
[0m23:12:12.693124 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:12.693395 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:12:12.693488 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:12:12.693571 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:12:12.693733 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:12.693854 [debug] [ThreadPool]: On create_weather_main: Close
[0m23:12:12.694255 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_weather_main, now list_weather_main)
[0m23:12:12.697501 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:12:12.697620 [debug] [ThreadPool]: On list_weather_main: BEGIN
[0m23:12:12.697710 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:12.697887 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:12.697975 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:12:12.698063 [debug] [ThreadPool]: On list_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather_main"} */
select
      'weather' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'weather'
  
[0m23:12:12.701814 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m23:12:12.702295 [debug] [ThreadPool]: On list_weather_main: ROLLBACK
[0m23:12:12.702719 [debug] [ThreadPool]: Failed to rollback 'list_weather_main'
[0m23:12:12.702821 [debug] [ThreadPool]: On list_weather_main: Close
[0m23:12:12.703137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '98bf7bdd-4873-491d-b2ff-075b47bd2753', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7ee430>]}
[0m23:12:12.703289 [debug] [MainThread]: Using duckdb connection "master"
[0m23:12:12.703386 [debug] [MainThread]: On master: BEGIN
[0m23:12:12.703472 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:12:12.703639 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:12:12.703728 [debug] [MainThread]: On master: COMMIT
[0m23:12:12.703815 [debug] [MainThread]: Using duckdb connection "master"
[0m23:12:12.703907 [debug] [MainThread]: On master: COMMIT
[0m23:12:12.704052 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:12:12.704138 [debug] [MainThread]: On master: Close
[0m23:12:12.704826 [debug] [Thread-1 (]: Began running node model.dwd_weather.stg_weather
[0m23:12:12.704997 [info ] [Thread-1 (]: 1 of 2 START sql view model main.stg_weather ................................... [RUN]
[0m23:12:12.705163 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_weather_main, now model.dwd_weather.stg_weather)
[0m23:12:12.705281 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.stg_weather
[0m23:12:12.707458 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.stg_weather"
[0m23:12:12.707720 [debug] [Thread-1 (]: Began executing node model.dwd_weather.stg_weather
[0m23:12:12.742465 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.stg_weather"
[0m23:12:12.742869 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:12.742998 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: BEGIN
[0m23:12:12.743105 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:12.743375 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:12.743484 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:12.743595 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

  
  create view "weather"."main"."stg_weather__dbt_tmp" as (
    with source as (
    select * from read_csv_auto('/Users/norangmangto/works/data_engineering/dwd_weather_prediction/data/raw/dwd_daily_01078.csv')
),

renamed as (
    select
        station_id,
        date::date as date,
        parameter,
        value,
        quality
    from source
)

select * from renamed
  );

[0m23:12:12.778777 [debug] [Thread-1 (]: SQL status: OK in 0.035 seconds
[0m23:12:12.781290 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:12.781432 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather" rename to "stg_weather__dbt_backup"
[0m23:12:12.781680 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:12.782881 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:12.783024 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather__dbt_tmp" rename to "stg_weather"
[0m23:12:12.783246 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:12.787589 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:12:12.787747 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:12.787857 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:12:12.788313 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:12.790141 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:12.790273 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

      drop view if exists "weather"."main"."stg_weather__dbt_backup" cascade
    
[0m23:12:12.790544 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:12.791429 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: Close
[0m23:12:12.792043 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98bf7bdd-4873-491d-b2ff-075b47bd2753', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10db1ed00>]}
[0m23:12:12.792264 [info ] [Thread-1 (]: 1 of 2 OK created sql view model main.stg_weather .............................. [[32mOK[0m in 0.09s]
[0m23:12:12.792475 [debug] [Thread-1 (]: Finished running node model.dwd_weather.stg_weather
[0m23:12:12.792755 [debug] [Thread-1 (]: Began running node model.dwd_weather.int_weather_features
[0m23:12:12.792947 [info ] [Thread-1 (]: 2 of 2 START sql view model main.int_weather_features .......................... [RUN]
[0m23:12:12.793154 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dwd_weather.stg_weather, now model.dwd_weather.int_weather_features)
[0m23:12:12.793311 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.int_weather_features
[0m23:12:12.794458 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.int_weather_features"
[0m23:12:12.794710 [debug] [Thread-1 (]: Began executing node model.dwd_weather.int_weather_features
[0m23:12:12.795687 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.int_weather_features"
[0m23:12:12.795890 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:12.795998 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: BEGIN
[0m23:12:12.796099 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:12.796291 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:12.796405 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:12.796564 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

  
  create view "weather"."main"."int_weather_features__dbt_tmp" as (
    with weather_data as (
    select * from "weather"."main"."stg_weather"
),

pivoted as (
    select
        date,
        max(case when parameter = 'temperature_air_mean_2m' then value end) as temp_mean,
        max(case when parameter = 'temperature_air_max_2m' then value end) as temp_max,
        max(case when parameter = 'temperature_air_min_2m' then value end) as temp_min,
        max(case when parameter = 'wind_speed' then value end) as wind_speed,
        max(case when parameter = 'precipitation_height' then value end) as precipitation,
        max(case when parameter = 'humidity' then value end) as humidity,
        max(case when parameter = 'sunshine_duration' then value end) as sunshine
    from weather_data
    group by date
),

cleaned as (
    select
        date,
        -- Simple interpolation or filling could be done here, but SQL window functions for interpolation are complex.
        -- We will assume data is mostly complete or handle nulls in training.
        -- For now, let's just use the values.
        temp_mean,
        temp_max,
        temp_min,
        wind_speed,
        coalesce(precipitation, 0) as precipitation, -- Assume 0 if null for precip
        humidity,
        sunshine,
        case when coalesce(precipitation, 0) > 0 then 1 else 0 end as is_raining
    from pivoted
),

features as (
    select
        *,
        -- Lag features (Past 1 day)
        lag(temp_mean, 1) over (order by date) as temp_mean_lag_1,
        lag(temp_max, 1) over (order by date) as temp_max_lag_1,
        lag(temp_min, 1) over (order by date) as temp_min_lag_1,
        lag(wind_speed, 1) over (order by date) as wind_speed_lag_1,
        lag(humidity, 1) over (order by date) as humidity_lag_1,
        lag(precipitation, 1) over (order by date) as precipitation_lag_1,

        -- Targets (Next 1 day)
        lead(temp_mean, 1) over (order by date) as target_temp_mean_day_1,
        lead(temp_max, 1) over (order by date) as target_temp_max_day_1,
        lead(temp_min, 1) over (order by date) as target_temp_min_day_1,
        lead(wind_speed, 1) over (order by date) as target_wind_speed_day_1,
        lead(humidity, 1) over (order by date) as target_humidity_day_1,
        lead(is_raining, 1) over (order by date) as target_is_raining_day_1
    from cleaned
)

select * from features
where date < current_date -- Filter out future empty rows if any
  );

[0m23:12:12.831701 [debug] [Thread-1 (]: SQL status: OK in 0.035 seconds
[0m23:12:12.833177 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:12.833335 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features" rename to "int_weather_features__dbt_backup"
[0m23:12:12.833613 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:12.834510 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:12.834629 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features__dbt_tmp" rename to "int_weather_features"
[0m23:12:12.834919 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:12.835507 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:12:12.835845 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:12.836437 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:12:12.837176 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:12.837988 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:12.838104 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

      drop view if exists "weather"."main"."int_weather_features__dbt_backup" cascade
    
[0m23:12:12.838391 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:12.839062 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: Close
[0m23:12:12.839272 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '98bf7bdd-4873-491d-b2ff-075b47bd2753', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7d5910>]}
[0m23:12:12.839498 [info ] [Thread-1 (]: 2 of 2 OK created sql view model main.int_weather_features ..................... [[32mOK[0m in 0.05s]
[0m23:12:12.839708 [debug] [Thread-1 (]: Finished running node model.dwd_weather.int_weather_features
[0m23:12:12.840158 [debug] [MainThread]: Using duckdb connection "master"
[0m23:12:12.840271 [debug] [MainThread]: On master: BEGIN
[0m23:12:12.840364 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:12:12.840538 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:12:12.840639 [debug] [MainThread]: On master: COMMIT
[0m23:12:12.840735 [debug] [MainThread]: Using duckdb connection "master"
[0m23:12:12.840828 [debug] [MainThread]: On master: COMMIT
[0m23:12:12.840964 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:12:12.841058 [debug] [MainThread]: On master: Close
[0m23:12:12.841179 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:12:12.841271 [debug] [MainThread]: Connection 'model.dwd_weather.int_weather_features' was properly closed.
[0m23:12:12.841380 [info ] [MainThread]: 
[0m23:12:12.841490 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m23:12:12.841772 [debug] [MainThread]: Command end result
[0m23:12:12.848567 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:12:12.849322 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:12:12.851725 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/run_results.json
[0m23:12:12.851849 [info ] [MainThread]: 
[0m23:12:12.851991 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:12:12.852099 [info ] [MainThread]: 
[0m23:12:12.852218 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m23:12:12.853218 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 0.43006626, "process_in_blocks": "0", "process_kernel_time": 0.114118, "process_mem_max_rss": "180289536", "process_out_blocks": "0", "process_user_time": 0.84755}
[0m23:12:12.853371 [debug] [MainThread]: Command `dbt build` succeeded at 23:12:12.853340 after 0.43 seconds
[0m23:12:12.853490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d829d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d8aaa30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d8aae90>]}
[0m23:12:12.853604 [debug] [MainThread]: Flushing usage events
[0m23:12:13.269218 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:12:26.622196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1080ec050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091979d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109197b10>]}


============================== 23:12:26.623993 | f450b8f7-4775-4ead-8152-5f6cb5a7fff5 ==============================
[0m23:12:26.623993 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:12:26.624245 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'debug': 'False', 'invocation_command': 'dbt build --profiles-dir .', 'static_parser': 'True', 'warn_error': 'None', 'log_cache_events': 'False', 'write_json': 'True', 'log_format': 'default', 'introspect': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'printer_width': '80', 'partial_parse': 'True', 'empty': 'False', 'version_check': 'True', 'log_path': '/Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m23:12:26.700922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f450b8f7-4775-4ead-8152-5f6cb5a7fff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084f0b00>]}
[0m23:12:26.722815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f450b8f7-4775-4ead-8152-5f6cb5a7fff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090539b0>]}
[0m23:12:26.723488 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m23:12:26.762049 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:12:26.793495 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:12:26.793663 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:12:26.803391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f450b8f7-4775-4ead-8152-5f6cb5a7fff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10928b350>]}
[0m23:12:26.823510 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:12:26.824295 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:12:26.834317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f450b8f7-4775-4ead-8152-5f6cb5a7fff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097958b0>]}
[0m23:12:26.834532 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:12:26.835455 [info ] [MainThread]: 
[0m23:12:26.835600 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:12:26.835713 [info ] [MainThread]: 
[0m23:12:26.835904 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m23:12:26.837740 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_weather'
[0m23:12:26.857455 [debug] [ThreadPool]: Using duckdb connection "list_weather"
[0m23:12:26.857634 [debug] [ThreadPool]: On list_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"weather"'
    
  
  
[0m23:12:26.857742 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:12:26.862248 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m23:12:26.862731 [debug] [ThreadPool]: On list_weather: Close
[0m23:12:26.862990 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_weather, now create_weather_main)
[0m23:12:26.863155 [debug] [ThreadPool]: Creating schema "database: "weather"
schema: "main"
"
[0m23:12:26.865560 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:12:26.865670 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='weather'
        and type='sqlite'
    
  
[0m23:12:26.865835 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:26.866171 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:26.866604 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:12:26.866697 [debug] [ThreadPool]: On create_weather_main: BEGIN
[0m23:12:26.866852 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:26.866944 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:12:26.867062 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
    
        create schema if not exists "weather"."main"
    
[0m23:12:26.867246 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:26.867545 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:12:26.867647 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:12:26.867732 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:12:26.867870 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:26.867961 [debug] [ThreadPool]: On create_weather_main: Close
[0m23:12:26.868358 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_weather_main, now list_weather_main)
[0m23:12:26.871790 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:12:26.871924 [debug] [ThreadPool]: On list_weather_main: BEGIN
[0m23:12:26.872021 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:26.872215 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:26.872307 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:12:26.872398 [debug] [ThreadPool]: On list_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather_main"} */
select
      'weather' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'weather'
  
[0m23:12:26.876084 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m23:12:26.876560 [debug] [ThreadPool]: On list_weather_main: ROLLBACK
[0m23:12:26.876979 [debug] [ThreadPool]: Failed to rollback 'list_weather_main'
[0m23:12:26.877080 [debug] [ThreadPool]: On list_weather_main: Close
[0m23:12:26.877388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f450b8f7-4775-4ead-8152-5f6cb5a7fff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097ce430>]}
[0m23:12:26.877542 [debug] [MainThread]: Using duckdb connection "master"
[0m23:12:26.877631 [debug] [MainThread]: On master: BEGIN
[0m23:12:26.877714 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:12:26.877873 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:12:26.877959 [debug] [MainThread]: On master: COMMIT
[0m23:12:26.878043 [debug] [MainThread]: Using duckdb connection "master"
[0m23:12:26.878121 [debug] [MainThread]: On master: COMMIT
[0m23:12:26.878278 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:12:26.878418 [debug] [MainThread]: On master: Close
[0m23:12:26.879104 [debug] [Thread-1 (]: Began running node model.dwd_weather.stg_weather
[0m23:12:26.879271 [info ] [Thread-1 (]: 1 of 2 START sql view model main.stg_weather ................................... [RUN]
[0m23:12:26.879427 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_weather_main, now model.dwd_weather.stg_weather)
[0m23:12:26.879553 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.stg_weather
[0m23:12:26.881699 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.stg_weather"
[0m23:12:26.881958 [debug] [Thread-1 (]: Began executing node model.dwd_weather.stg_weather
[0m23:12:26.916650 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.stg_weather"
[0m23:12:26.917068 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:26.917201 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: BEGIN
[0m23:12:26.917309 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:26.917630 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:26.917772 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:26.917894 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

  
  create view "weather"."main"."stg_weather__dbt_tmp" as (
    with source as (
    select * from read_csv_auto('/Users/norangmangto/works/data_engineering/dwd_weather_prediction/data/raw/dwd_daily_01078.csv')
),

renamed as (
    select
        station_id,
        date::date as date,
        parameter,
        value,
        quality
    from source
)

select * from renamed
  );

[0m23:12:26.953681 [debug] [Thread-1 (]: SQL status: OK in 0.036 seconds
[0m23:12:26.956139 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:26.956277 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather" rename to "stg_weather__dbt_backup"
[0m23:12:26.956527 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:26.957567 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:26.957679 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather__dbt_tmp" rename to "stg_weather"
[0m23:12:26.957874 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:26.961990 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:12:26.962113 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:26.962216 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:12:26.962618 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:26.964371 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:26.964483 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

      drop view if exists "weather"."main"."stg_weather__dbt_backup" cascade
    
[0m23:12:26.964723 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:26.965616 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: Close
[0m23:12:26.966364 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f450b8f7-4775-4ead-8152-5f6cb5a7fff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b06d00>]}
[0m23:12:26.966647 [info ] [Thread-1 (]: 1 of 2 OK created sql view model main.stg_weather .............................. [[32mOK[0m in 0.09s]
[0m23:12:26.966866 [debug] [Thread-1 (]: Finished running node model.dwd_weather.stg_weather
[0m23:12:26.967177 [debug] [Thread-1 (]: Began running node model.dwd_weather.int_weather_features
[0m23:12:26.967365 [info ] [Thread-1 (]: 2 of 2 START sql view model main.int_weather_features .......................... [RUN]
[0m23:12:26.967521 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dwd_weather.stg_weather, now model.dwd_weather.int_weather_features)
[0m23:12:26.967646 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.int_weather_features
[0m23:12:26.968732 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.int_weather_features"
[0m23:12:26.968960 [debug] [Thread-1 (]: Began executing node model.dwd_weather.int_weather_features
[0m23:12:26.969918 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.int_weather_features"
[0m23:12:26.970117 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:26.970223 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: BEGIN
[0m23:12:26.970324 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:26.970515 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:26.970627 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:26.970782 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

  
  create view "weather"."main"."int_weather_features__dbt_tmp" as (
    with weather_data as (
    select * from "weather"."main"."stg_weather"
),

pivoted as (
    select
        date,
        max(case when parameter = 'temperature_air_mean_2m' then value end) as temp_mean,
        max(case when parameter = 'temperature_air_max_2m' then value end) as temp_max,
        max(case when parameter = 'temperature_air_min_2m' then value end) as temp_min,
        max(case when parameter = 'wind_speed' then value end) as wind_speed,
        max(case when parameter = 'precipitation_height' then value end) as precipitation,
        max(case when parameter = 'humidity' then value end) as humidity,
        max(case when parameter = 'sunshine_duration' then value end) as sunshine
    from weather_data
    group by date
),

cleaned as (
    select
        date,
        -- Simple interpolation or filling could be done here, but SQL window functions for interpolation are complex.
        -- We will assume data is mostly complete or handle nulls in training.
        -- For now, let's just use the values.
        temp_mean,
        temp_max,
        temp_min,
        wind_speed,
        coalesce(precipitation, 0) as precipitation, -- Assume 0 if null for precip
        humidity,
        sunshine,
        case when coalesce(precipitation, 0) > 0 then 1 else 0 end as is_raining
    from pivoted
),

features as (
    select
        *,
        -- Lag features (Past 1 day)
        lag(temp_mean, 1) over (order by date) as temp_mean_lag_1,
        lag(temp_max, 1) over (order by date) as temp_max_lag_1,
        lag(temp_min, 1) over (order by date) as temp_min_lag_1,
        lag(wind_speed, 1) over (order by date) as wind_speed_lag_1,
        lag(humidity, 1) over (order by date) as humidity_lag_1,
        lag(precipitation, 1) over (order by date) as precipitation_lag_1,

        -- Targets (Next 1 day)
        lead(temp_mean, 1) over (order by date) as target_temp_mean_day_1,
        lead(temp_max, 1) over (order by date) as target_temp_max_day_1,
        lead(temp_min, 1) over (order by date) as target_temp_min_day_1,
        lead(wind_speed, 1) over (order by date) as target_wind_speed_day_1,
        lead(humidity, 1) over (order by date) as target_humidity_day_1,
        lead(is_raining, 1) over (order by date) as target_is_raining_day_1
    from cleaned
)

select * from features
where date < current_date -- Filter out future empty rows if any
  );

[0m23:12:27.006014 [debug] [Thread-1 (]: SQL status: OK in 0.035 seconds
[0m23:12:27.007486 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:27.007643 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features" rename to "int_weather_features__dbt_backup"
[0m23:12:27.007917 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:27.008800 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:27.008914 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features__dbt_tmp" rename to "int_weather_features"
[0m23:12:27.009138 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:27.009621 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:12:27.009733 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:27.009833 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:12:27.010239 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:27.010943 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:27.011060 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

      drop view if exists "weather"."main"."int_weather_features__dbt_backup" cascade
    
[0m23:12:27.011333 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:27.011988 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: Close
[0m23:12:27.012204 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f450b8f7-4775-4ead-8152-5f6cb5a7fff5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097bd910>]}
[0m23:12:27.012425 [info ] [Thread-1 (]: 2 of 2 OK created sql view model main.int_weather_features ..................... [[32mOK[0m in 0.04s]
[0m23:12:27.012646 [debug] [Thread-1 (]: Finished running node model.dwd_weather.int_weather_features
[0m23:12:27.013122 [debug] [MainThread]: Using duckdb connection "master"
[0m23:12:27.013253 [debug] [MainThread]: On master: BEGIN
[0m23:12:27.013357 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:12:27.013532 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:12:27.013641 [debug] [MainThread]: On master: COMMIT
[0m23:12:27.013741 [debug] [MainThread]: Using duckdb connection "master"
[0m23:12:27.013834 [debug] [MainThread]: On master: COMMIT
[0m23:12:27.013982 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:12:27.014094 [debug] [MainThread]: On master: Close
[0m23:12:27.014224 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:12:27.014317 [debug] [MainThread]: Connection 'model.dwd_weather.int_weather_features' was properly closed.
[0m23:12:27.014428 [info ] [MainThread]: 
[0m23:12:27.014546 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m23:12:27.014828 [debug] [MainThread]: Command end result
[0m23:12:27.022516 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:12:27.023223 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:12:27.025485 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/run_results.json
[0m23:12:27.025595 [info ] [MainThread]: 
[0m23:12:27.025730 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:12:27.025836 [info ] [MainThread]: 
[0m23:12:27.025956 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m23:12:27.027001 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 0.43031, "process_in_blocks": "0", "process_kernel_time": 0.108893, "process_mem_max_rss": "180305920", "process_out_blocks": "0", "process_user_time": 0.836691}
[0m23:12:27.027154 [debug] [MainThread]: Command `dbt build` succeeded at 23:12:27.027122 after 0.43 seconds
[0m23:12:27.027281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109811d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109892a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109892e90>]}
[0m23:12:27.027399 [debug] [MainThread]: Flushing usage events
[0m23:12:27.457309 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:12:40.786035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0a0050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b14b9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b14bb10>]}


============================== 23:12:40.787758 | 50c3cf79-6db6-4b17-9e92-6a3e4f78cc6e ==============================
[0m23:12:40.787758 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:12:40.788008 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'indirect_selection': 'eager', 'empty': 'False', 'quiet': 'False', 'static_parser': 'True', 'log_path': '/Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/logs', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'target_path': 'None', 'cache_selected_only': 'False', 'log_format': 'default', 'fail_fast': 'False', 'use_colors': 'True', 'write_json': 'True', 'profiles_dir': '.', 'log_cache_events': 'False', 'debug': 'False', 'no_print': 'None', 'invocation_command': 'dbt build --profiles-dir .', 'warn_error': 'None', 'introspect': 'True', 'version_check': 'True'}
[0m23:12:40.864265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '50c3cf79-6db6-4b17-9e92-6a3e4f78cc6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4a8b00>]}
[0m23:12:40.887366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '50c3cf79-6db6-4b17-9e92-6a3e4f78cc6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b0039b0>]}
[0m23:12:40.888407 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m23:12:40.924410 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:12:40.954743 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:12:40.954908 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:12:40.964530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '50c3cf79-6db6-4b17-9e92-6a3e4f78cc6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b23f350>]}
[0m23:12:40.984937 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:12:40.985803 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:12:40.996097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '50c3cf79-6db6-4b17-9e92-6a3e4f78cc6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b74d8b0>]}
[0m23:12:40.996299 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:12:40.997130 [info ] [MainThread]: 
[0m23:12:40.997265 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:12:40.997369 [info ] [MainThread]: 
[0m23:12:40.997562 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m23:12:40.999263 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_weather'
[0m23:12:41.018355 [debug] [ThreadPool]: Using duckdb connection "list_weather"
[0m23:12:41.018525 [debug] [ThreadPool]: On list_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"weather"'
    
  
  
[0m23:12:41.018627 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:12:41.023117 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m23:12:41.023591 [debug] [ThreadPool]: On list_weather: Close
[0m23:12:41.023818 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_weather, now create_weather_main)
[0m23:12:41.023967 [debug] [ThreadPool]: Creating schema "database: "weather"
schema: "main"
"
[0m23:12:41.026257 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:12:41.026360 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='weather'
        and type='sqlite'
    
  
[0m23:12:41.026446 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:41.026704 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:41.027129 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:12:41.027220 [debug] [ThreadPool]: On create_weather_main: BEGIN
[0m23:12:41.027359 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:41.027443 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:12:41.027525 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
    
        create schema if not exists "weather"."main"
    
[0m23:12:41.027683 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:41.027942 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:12:41.028035 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:12:41.028117 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:12:41.028280 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:41.028427 [debug] [ThreadPool]: On create_weather_main: Close
[0m23:12:41.028820 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_weather_main, now list_weather_main)
[0m23:12:41.032134 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:12:41.032280 [debug] [ThreadPool]: On list_weather_main: BEGIN
[0m23:12:41.032378 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:41.032597 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:41.032695 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:12:41.032789 [debug] [ThreadPool]: On list_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather_main"} */
select
      'weather' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'weather'
  
[0m23:12:41.036513 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m23:12:41.036997 [debug] [ThreadPool]: On list_weather_main: ROLLBACK
[0m23:12:41.037418 [debug] [ThreadPool]: Failed to rollback 'list_weather_main'
[0m23:12:41.037521 [debug] [ThreadPool]: On list_weather_main: Close
[0m23:12:41.037844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '50c3cf79-6db6-4b17-9e92-6a3e4f78cc6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b78a430>]}
[0m23:12:41.038000 [debug] [MainThread]: Using duckdb connection "master"
[0m23:12:41.038090 [debug] [MainThread]: On master: BEGIN
[0m23:12:41.038175 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:12:41.038342 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:12:41.038428 [debug] [MainThread]: On master: COMMIT
[0m23:12:41.038513 [debug] [MainThread]: Using duckdb connection "master"
[0m23:12:41.038593 [debug] [MainThread]: On master: COMMIT
[0m23:12:41.038741 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:12:41.038840 [debug] [MainThread]: On master: Close
[0m23:12:41.039515 [debug] [Thread-1 (]: Began running node model.dwd_weather.stg_weather
[0m23:12:41.039690 [info ] [Thread-1 (]: 1 of 2 START sql view model main.stg_weather ................................... [RUN]
[0m23:12:41.039854 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_weather_main, now model.dwd_weather.stg_weather)
[0m23:12:41.039972 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.stg_weather
[0m23:12:41.042103 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.stg_weather"
[0m23:12:41.042366 [debug] [Thread-1 (]: Began executing node model.dwd_weather.stg_weather
[0m23:12:41.077526 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.stg_weather"
[0m23:12:41.077927 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:41.078049 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: BEGIN
[0m23:12:41.078164 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:41.078417 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:41.078523 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:41.078633 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

  
  create view "weather"."main"."stg_weather__dbt_tmp" as (
    with source as (
    select * from read_csv_auto('/Users/norangmangto/works/data_engineering/dwd_weather_prediction/data/raw/dwd_daily_01078.csv')
),

renamed as (
    select
        station_id,
        date::date as date,
        parameter,
        value,
        quality
    from source
)

select * from renamed
  );

[0m23:12:41.113794 [debug] [Thread-1 (]: SQL status: OK in 0.035 seconds
[0m23:12:41.116266 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:41.116418 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather" rename to "stg_weather__dbt_backup"
[0m23:12:41.116695 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:41.117775 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:41.117891 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather__dbt_tmp" rename to "stg_weather"
[0m23:12:41.118089 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:41.122219 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:12:41.122338 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:41.122440 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:12:41.122834 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:41.124556 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:41.124665 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

      drop view if exists "weather"."main"."stg_weather__dbt_backup" cascade
    
[0m23:12:41.124888 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:41.125736 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: Close
[0m23:12:41.126338 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '50c3cf79-6db6-4b17-9e92-6a3e4f78cc6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bb32d00>]}
[0m23:12:41.126554 [info ] [Thread-1 (]: 1 of 2 OK created sql view model main.stg_weather .............................. [[32mOK[0m in 0.09s]
[0m23:12:41.126763 [debug] [Thread-1 (]: Finished running node model.dwd_weather.stg_weather
[0m23:12:41.127031 [debug] [Thread-1 (]: Began running node model.dwd_weather.int_weather_features
[0m23:12:41.127218 [info ] [Thread-1 (]: 2 of 2 START sql view model main.int_weather_features .......................... [RUN]
[0m23:12:41.127385 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dwd_weather.stg_weather, now model.dwd_weather.int_weather_features)
[0m23:12:41.127512 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.int_weather_features
[0m23:12:41.128577 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.int_weather_features"
[0m23:12:41.128825 [debug] [Thread-1 (]: Began executing node model.dwd_weather.int_weather_features
[0m23:12:41.129762 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.int_weather_features"
[0m23:12:41.129957 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:41.130065 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: BEGIN
[0m23:12:41.130166 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:41.130346 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:41.130457 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:41.130611 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

  
  create view "weather"."main"."int_weather_features__dbt_tmp" as (
    with weather_data as (
    select * from "weather"."main"."stg_weather"
),

pivoted as (
    select
        date,
        max(case when parameter = 'temperature_air_mean_2m' then value end) as temp_mean,
        max(case when parameter = 'temperature_air_max_2m' then value end) as temp_max,
        max(case when parameter = 'temperature_air_min_2m' then value end) as temp_min,
        max(case when parameter = 'wind_speed' then value end) as wind_speed,
        max(case when parameter = 'precipitation_height' then value end) as precipitation,
        max(case when parameter = 'humidity' then value end) as humidity,
        max(case when parameter = 'sunshine_duration' then value end) as sunshine
    from weather_data
    group by date
),

cleaned as (
    select
        date,
        -- Simple interpolation or filling could be done here, but SQL window functions for interpolation are complex.
        -- We will assume data is mostly complete or handle nulls in training.
        -- For now, let's just use the values.
        temp_mean,
        temp_max,
        temp_min,
        wind_speed,
        coalesce(precipitation, 0) as precipitation, -- Assume 0 if null for precip
        humidity,
        sunshine,
        case when coalesce(precipitation, 0) > 0 then 1 else 0 end as is_raining
    from pivoted
),

features as (
    select
        *,
        -- Lag features (Past 1 day)
        lag(temp_mean, 1) over (order by date) as temp_mean_lag_1,
        lag(temp_max, 1) over (order by date) as temp_max_lag_1,
        lag(temp_min, 1) over (order by date) as temp_min_lag_1,
        lag(wind_speed, 1) over (order by date) as wind_speed_lag_1,
        lag(humidity, 1) over (order by date) as humidity_lag_1,
        lag(precipitation, 1) over (order by date) as precipitation_lag_1,

        -- Targets (Next 1 day)
        lead(temp_mean, 1) over (order by date) as target_temp_mean_day_1,
        lead(temp_max, 1) over (order by date) as target_temp_max_day_1,
        lead(temp_min, 1) over (order by date) as target_temp_min_day_1,
        lead(wind_speed, 1) over (order by date) as target_wind_speed_day_1,
        lead(humidity, 1) over (order by date) as target_humidity_day_1,
        lead(is_raining, 1) over (order by date) as target_is_raining_day_1
    from cleaned
)

select * from features
where date < current_date -- Filter out future empty rows if any
  );

[0m23:12:41.165774 [debug] [Thread-1 (]: SQL status: OK in 0.035 seconds
[0m23:12:41.167268 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:41.167434 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features" rename to "int_weather_features__dbt_backup"
[0m23:12:41.167728 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:41.168658 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:41.168775 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features__dbt_tmp" rename to "int_weather_features"
[0m23:12:41.169001 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:41.169483 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:12:41.169594 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:41.169695 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:12:41.170148 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:41.170901 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:41.171028 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

      drop view if exists "weather"."main"."int_weather_features__dbt_backup" cascade
    
[0m23:12:41.171313 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:41.171914 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: Close
[0m23:12:41.172118 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '50c3cf79-6db6-4b17-9e92-6a3e4f78cc6e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b771610>]}
[0m23:12:41.172336 [info ] [Thread-1 (]: 2 of 2 OK created sql view model main.int_weather_features ..................... [[32mOK[0m in 0.04s]
[0m23:12:41.172547 [debug] [Thread-1 (]: Finished running node model.dwd_weather.int_weather_features
[0m23:12:41.173003 [debug] [MainThread]: Using duckdb connection "master"
[0m23:12:41.173132 [debug] [MainThread]: On master: BEGIN
[0m23:12:41.173231 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:12:41.173394 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:12:41.173491 [debug] [MainThread]: On master: COMMIT
[0m23:12:41.173584 [debug] [MainThread]: Using duckdb connection "master"
[0m23:12:41.173676 [debug] [MainThread]: On master: COMMIT
[0m23:12:41.173838 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:12:41.173957 [debug] [MainThread]: On master: Close
[0m23:12:41.174093 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:12:41.174187 [debug] [MainThread]: Connection 'model.dwd_weather.int_weather_features' was properly closed.
[0m23:12:41.174296 [info ] [MainThread]: 
[0m23:12:41.174414 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m23:12:41.174695 [debug] [MainThread]: Command end result
[0m23:12:41.181615 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:12:41.182252 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:12:41.184535 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/run_results.json
[0m23:12:41.184659 [info ] [MainThread]: 
[0m23:12:41.184791 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:12:41.184897 [info ] [MainThread]: 
[0m23:12:41.185015 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m23:12:41.185990 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 0.4256355, "process_in_blocks": "0", "process_kernel_time": 0.10619, "process_mem_max_rss": "180420608", "process_out_blocks": "0", "process_user_time": 0.833085}
[0m23:12:41.186140 [debug] [MainThread]: Command `dbt build` succeeded at 23:12:41.186110 after 0.43 seconds
[0m23:12:41.186261 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7c9d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b846a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b846e90>]}
[0m23:12:41.186376 [debug] [MainThread]: Flushing usage events
[0m23:12:41.605508 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:12:54.945614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c910050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9bb9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d9bbb10>]}


============================== 23:12:54.947343 | 37603d96-23a8-4835-8fdd-c10edf0e839a ==============================
[0m23:12:54.947343 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:12:54.947602 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'use_experimental_parser': 'False', 'version_check': 'True', 'warn_error': 'None', 'invocation_command': 'dbt build --profiles-dir .', 'profiles_dir': '.', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'log_format': 'default', 'indirect_selection': 'eager', 'quiet': 'False', 'log_path': '/Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/logs', 'introspect': 'True', 'write_json': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'printer_width': '80', 'static_parser': 'True', 'use_colors': 'True', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'no_print': 'None'}
[0m23:12:55.024845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '37603d96-23a8-4835-8fdd-c10edf0e839a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cd14b00>]}
[0m23:12:55.048881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '37603d96-23a8-4835-8fdd-c10edf0e839a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d8779b0>]}
[0m23:12:55.049791 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m23:12:55.085358 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:12:55.122532 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:12:55.122720 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:12:55.133295 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '37603d96-23a8-4835-8fdd-c10edf0e839a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10daaf350>]}
[0m23:12:55.154794 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:12:55.155632 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:12:55.165129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '37603d96-23a8-4835-8fdd-c10edf0e839a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dfbd8b0>]}
[0m23:12:55.165324 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:12:55.166363 [info ] [MainThread]: 
[0m23:12:55.166537 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:12:55.166658 [info ] [MainThread]: 
[0m23:12:55.166863 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m23:12:55.168636 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_weather'
[0m23:12:55.187444 [debug] [ThreadPool]: Using duckdb connection "list_weather"
[0m23:12:55.187601 [debug] [ThreadPool]: On list_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"weather"'
    
  
  
[0m23:12:55.187704 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:12:55.192204 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m23:12:55.192694 [debug] [ThreadPool]: On list_weather: Close
[0m23:12:55.192930 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_weather, now create_weather_main)
[0m23:12:55.193082 [debug] [ThreadPool]: Creating schema "database: "weather"
schema: "main"
"
[0m23:12:55.195409 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:12:55.195522 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='weather'
        and type='sqlite'
    
  
[0m23:12:55.195614 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:55.195873 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:55.196298 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:12:55.196388 [debug] [ThreadPool]: On create_weather_main: BEGIN
[0m23:12:55.196530 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:55.196616 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:12:55.196698 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
    
        create schema if not exists "weather"."main"
    
[0m23:12:55.196889 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:55.197246 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:12:55.197365 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:12:55.197465 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:12:55.197637 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:55.197741 [debug] [ThreadPool]: On create_weather_main: Close
[0m23:12:55.198116 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_weather_main, now list_weather_main)
[0m23:12:55.201322 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:12:55.201449 [debug] [ThreadPool]: On list_weather_main: BEGIN
[0m23:12:55.201542 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:12:55.201732 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:12:55.201820 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:12:55.201911 [debug] [ThreadPool]: On list_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather_main"} */
select
      'weather' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'weather'
  
[0m23:12:55.205717 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m23:12:55.206225 [debug] [ThreadPool]: On list_weather_main: ROLLBACK
[0m23:12:55.206655 [debug] [ThreadPool]: Failed to rollback 'list_weather_main'
[0m23:12:55.206754 [debug] [ThreadPool]: On list_weather_main: Close
[0m23:12:55.207091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '37603d96-23a8-4835-8fdd-c10edf0e839a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dffa430>]}
[0m23:12:55.207297 [debug] [MainThread]: Using duckdb connection "master"
[0m23:12:55.207422 [debug] [MainThread]: On master: BEGIN
[0m23:12:55.207530 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:12:55.207724 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:12:55.207829 [debug] [MainThread]: On master: COMMIT
[0m23:12:55.207926 [debug] [MainThread]: Using duckdb connection "master"
[0m23:12:55.208017 [debug] [MainThread]: On master: COMMIT
[0m23:12:55.208195 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:12:55.208293 [debug] [MainThread]: On master: Close
[0m23:12:55.209090 [debug] [Thread-1 (]: Began running node model.dwd_weather.stg_weather
[0m23:12:55.209283 [info ] [Thread-1 (]: 1 of 2 START sql view model main.stg_weather ................................... [RUN]
[0m23:12:55.209456 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_weather_main, now model.dwd_weather.stg_weather)
[0m23:12:55.209584 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.stg_weather
[0m23:12:55.211776 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.stg_weather"
[0m23:12:55.212041 [debug] [Thread-1 (]: Began executing node model.dwd_weather.stg_weather
[0m23:12:55.245473 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.stg_weather"
[0m23:12:55.245880 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:55.246009 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: BEGIN
[0m23:12:55.246118 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:55.246378 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:55.246482 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:55.246589 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

  
  create view "weather"."main"."stg_weather__dbt_tmp" as (
    with source as (
    select * from read_csv_auto('/Users/norangmangto/works/data_engineering/dwd_weather_prediction/data/raw/dwd_daily_01078.csv')
),

renamed as (
    select
        station_id,
        date::date as date,
        parameter,
        value,
        quality
    from source
)

select * from renamed
  );

[0m23:12:55.282881 [debug] [Thread-1 (]: SQL status: OK in 0.036 seconds
[0m23:12:55.285547 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:55.285698 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather" rename to "stg_weather__dbt_backup"
[0m23:12:55.285993 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:55.287186 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:55.287331 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather__dbt_tmp" rename to "stg_weather"
[0m23:12:55.287570 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:55.291847 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:12:55.291973 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:55.292079 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:12:55.292510 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:55.294345 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:12:55.294461 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

      drop view if exists "weather"."main"."stg_weather__dbt_backup" cascade
    
[0m23:12:55.294698 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:55.295579 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: Close
[0m23:12:55.296190 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '37603d96-23a8-4835-8fdd-c10edf0e839a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e396d00>]}
[0m23:12:55.296404 [info ] [Thread-1 (]: 1 of 2 OK created sql view model main.stg_weather .............................. [[32mOK[0m in 0.09s]
[0m23:12:55.296614 [debug] [Thread-1 (]: Finished running node model.dwd_weather.stg_weather
[0m23:12:55.296919 [debug] [Thread-1 (]: Began running node model.dwd_weather.int_weather_features
[0m23:12:55.297166 [info ] [Thread-1 (]: 2 of 2 START sql view model main.int_weather_features .......................... [RUN]
[0m23:12:55.297350 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dwd_weather.stg_weather, now model.dwd_weather.int_weather_features)
[0m23:12:55.297478 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.int_weather_features
[0m23:12:55.298561 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.int_weather_features"
[0m23:12:55.298788 [debug] [Thread-1 (]: Began executing node model.dwd_weather.int_weather_features
[0m23:12:55.299831 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.int_weather_features"
[0m23:12:55.300056 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:55.300176 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: BEGIN
[0m23:12:55.300290 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:12:55.300500 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:55.300614 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:55.300771 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

  
  create view "weather"."main"."int_weather_features__dbt_tmp" as (
    with weather_data as (
    select * from "weather"."main"."stg_weather"
),

pivoted as (
    select
        date,
        max(case when parameter = 'temperature_air_mean_2m' then value end) as temp_mean,
        max(case when parameter = 'temperature_air_max_2m' then value end) as temp_max,
        max(case when parameter = 'temperature_air_min_2m' then value end) as temp_min,
        max(case when parameter = 'wind_speed' then value end) as wind_speed,
        max(case when parameter = 'precipitation_height' then value end) as precipitation,
        max(case when parameter = 'humidity' then value end) as humidity,
        max(case when parameter = 'sunshine_duration' then value end) as sunshine
    from weather_data
    group by date
),

cleaned as (
    select
        date,
        -- Simple interpolation or filling could be done here, but SQL window functions for interpolation are complex.
        -- We will assume data is mostly complete or handle nulls in training.
        -- For now, let's just use the values.
        temp_mean,
        temp_max,
        temp_min,
        wind_speed,
        coalesce(precipitation, 0) as precipitation, -- Assume 0 if null for precip
        humidity,
        sunshine,
        case when coalesce(precipitation, 0) > 0 then 1 else 0 end as is_raining
    from pivoted
),

features as (
    select
        *,
        -- Lag features (Past 1 day)
        lag(temp_mean, 1) over (order by date) as temp_mean_lag_1,
        lag(temp_max, 1) over (order by date) as temp_max_lag_1,
        lag(temp_min, 1) over (order by date) as temp_min_lag_1,
        lag(wind_speed, 1) over (order by date) as wind_speed_lag_1,
        lag(humidity, 1) over (order by date) as humidity_lag_1,
        lag(precipitation, 1) over (order by date) as precipitation_lag_1,

        -- Targets (Next 1 day)
        lead(temp_mean, 1) over (order by date) as target_temp_mean_day_1,
        lead(temp_max, 1) over (order by date) as target_temp_max_day_1,
        lead(temp_min, 1) over (order by date) as target_temp_min_day_1,
        lead(wind_speed, 1) over (order by date) as target_wind_speed_day_1,
        lead(humidity, 1) over (order by date) as target_humidity_day_1,
        lead(is_raining, 1) over (order by date) as target_is_raining_day_1
    from cleaned
)

select * from features
where date < current_date -- Filter out future empty rows if any
  );

[0m23:12:55.336574 [debug] [Thread-1 (]: SQL status: OK in 0.036 seconds
[0m23:12:55.338090 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:55.338242 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features" rename to "int_weather_features__dbt_backup"
[0m23:12:55.338660 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:55.340435 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:55.340556 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features__dbt_tmp" rename to "int_weather_features"
[0m23:12:55.340810 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:55.341311 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:12:55.341422 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:55.341523 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:12:55.341963 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:55.342749 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:12:55.342866 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

      drop view if exists "weather"."main"."int_weather_features__dbt_backup" cascade
    
[0m23:12:55.343124 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:12:55.343718 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: Close
[0m23:12:55.343916 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '37603d96-23a8-4835-8fdd-c10edf0e839a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dfad910>]}
[0m23:12:55.344137 [info ] [Thread-1 (]: 2 of 2 OK created sql view model main.int_weather_features ..................... [[32mOK[0m in 0.05s]
[0m23:12:55.344341 [debug] [Thread-1 (]: Finished running node model.dwd_weather.int_weather_features
[0m23:12:55.344792 [debug] [MainThread]: Using duckdb connection "master"
[0m23:12:55.344906 [debug] [MainThread]: On master: BEGIN
[0m23:12:55.345000 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:12:55.345159 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:12:55.345254 [debug] [MainThread]: On master: COMMIT
[0m23:12:55.345348 [debug] [MainThread]: Using duckdb connection "master"
[0m23:12:55.345439 [debug] [MainThread]: On master: COMMIT
[0m23:12:55.345568 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:12:55.345664 [debug] [MainThread]: On master: Close
[0m23:12:55.345785 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:12:55.345883 [debug] [MainThread]: Connection 'model.dwd_weather.int_weather_features' was properly closed.
[0m23:12:55.345991 [info ] [MainThread]: 
[0m23:12:55.346102 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m23:12:55.346376 [debug] [MainThread]: Command end result
[0m23:12:55.353379 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:12:55.354031 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:12:55.356238 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/run_results.json
[0m23:12:55.356373 [info ] [MainThread]: 
[0m23:12:55.356510 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:12:55.356618 [info ] [MainThread]: 
[0m23:12:55.356732 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m23:12:55.357759 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 0.4371921, "process_in_blocks": "0", "process_kernel_time": 0.10856, "process_mem_max_rss": "180338688", "process_out_blocks": "0", "process_user_time": 0.843319}
[0m23:12:55.357916 [debug] [MainThread]: Command `dbt build` succeeded at 23:12:55.357885 after 0.44 seconds
[0m23:12:55.358044 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e035d30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e0b6a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e0b6e90>]}
[0m23:12:55.358165 [debug] [MainThread]: Flushing usage events
[0m23:12:55.771801 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:21:12.794155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a60c830>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6c7890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6c7b10>]}


============================== 23:21:12.796697 | 1e55ef5d-ffe4-43e8-89e1-ecf1d45fd87b ==============================
[0m23:21:12.796697 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:21:12.796955 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'introspect': 'True', 'invocation_command': 'dbt build --profiles-dir .', 'debug': 'False', 'quiet': 'False', 'fail_fast': 'False', 'partial_parse': 'True', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'profiles_dir': '.', 'empty': 'False', 'no_print': 'None', 'target_path': 'None', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'log_format': 'default', 'use_colors': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'log_path': '/Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/logs', 'warn_error': 'None', 'use_experimental_parser': 'False', 'indirect_selection': 'eager'}
[0m23:21:12.938017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1e55ef5d-ffe4-43e8-89e1-ecf1d45fd87b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa0cfc0>]}
[0m23:21:12.960061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1e55ef5d-ffe4-43e8-89e1-ecf1d45fd87b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b573ce0>]}
[0m23:21:12.961590 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m23:21:13.002063 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:21:13.044632 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:21:13.044931 [debug] [MainThread]: Partial parsing: updated file: dwd_weather://models/intermediate/int_weather_features.sql
[0m23:21:13.127074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1e55ef5d-ffe4-43e8-89e1-ecf1d45fd87b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7b3050>]}
[0m23:21:13.147465 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:21:13.148327 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:21:13.187940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1e55ef5d-ffe4-43e8-89e1-ecf1d45fd87b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd27f20>]}
[0m23:21:13.188163 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:21:13.188993 [info ] [MainThread]: 
[0m23:21:13.189160 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:21:13.189274 [info ] [MainThread]: 
[0m23:21:13.189476 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m23:21:13.191242 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_weather'
[0m23:21:13.217203 [debug] [ThreadPool]: Using duckdb connection "list_weather"
[0m23:21:13.217383 [debug] [ThreadPool]: On list_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"weather"'
    
  
  
[0m23:21:13.217501 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:21:13.230764 [debug] [ThreadPool]: SQL status: OK in 0.013 seconds
[0m23:21:13.231327 [debug] [ThreadPool]: On list_weather: Close
[0m23:21:13.231581 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_weather, now create_weather_main)
[0m23:21:13.231731 [debug] [ThreadPool]: Creating schema "database: "weather"
schema: "main"
"
[0m23:21:13.234170 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:21:13.234282 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='weather'
        and type='sqlite'
    
  
[0m23:21:13.234373 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:21:13.234832 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:21:13.235298 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:21:13.235389 [debug] [ThreadPool]: On create_weather_main: BEGIN
[0m23:21:13.235525 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:21:13.235618 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:21:13.235712 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
    
        create schema if not exists "weather"."main"
    
[0m23:21:13.235920 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:21:13.236215 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:21:13.236321 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:21:13.236407 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:21:13.236566 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:21:13.236707 [debug] [ThreadPool]: On create_weather_main: Close
[0m23:21:13.237097 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_weather_main, now list_weather_main)
[0m23:21:13.239300 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:21:13.239399 [debug] [ThreadPool]: On list_weather_main: BEGIN
[0m23:21:13.239480 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:21:13.239621 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:21:13.239713 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:21:13.239808 [debug] [ThreadPool]: On list_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather_main"} */
select
      'weather' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'weather'
  
[0m23:21:13.245763 [debug] [ThreadPool]: SQL status: OK in 0.006 seconds
[0m23:21:13.246465 [debug] [ThreadPool]: On list_weather_main: ROLLBACK
[0m23:21:13.247175 [debug] [ThreadPool]: Failed to rollback 'list_weather_main'
[0m23:21:13.247279 [debug] [ThreadPool]: On list_weather_main: Close
[0m23:21:13.247606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1e55ef5d-ffe4-43e8-89e1-ecf1d45fd87b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b84f3f0>]}
[0m23:21:13.247786 [debug] [MainThread]: Using duckdb connection "master"
[0m23:21:13.247887 [debug] [MainThread]: On master: BEGIN
[0m23:21:13.247977 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:21:13.248152 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:21:13.248255 [debug] [MainThread]: On master: COMMIT
[0m23:21:13.248355 [debug] [MainThread]: Using duckdb connection "master"
[0m23:21:13.248449 [debug] [MainThread]: On master: COMMIT
[0m23:21:13.248615 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:21:13.248736 [debug] [MainThread]: On master: Close
[0m23:21:13.249767 [debug] [Thread-1 (]: Began running node model.dwd_weather.stg_weather
[0m23:21:13.249973 [info ] [Thread-1 (]: 1 of 2 START sql view model main.stg_weather ................................... [RUN]
[0m23:21:13.250148 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_weather_main, now model.dwd_weather.stg_weather)
[0m23:21:13.250284 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.stg_weather
[0m23:21:13.252479 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.stg_weather"
[0m23:21:13.252716 [debug] [Thread-1 (]: Began executing node model.dwd_weather.stg_weather
[0m23:21:13.263973 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.stg_weather"
[0m23:21:13.264279 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:21:13.264398 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: BEGIN
[0m23:21:13.264500 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:21:13.264714 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:21:13.264830 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:21:13.264953 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

  
  create view "weather"."main"."stg_weather__dbt_tmp" as (
    with source as (
    select * from read_csv_auto('/Users/norangmangto/works/data_engineering/dwd_weather_prediction/data/raw/dwd_daily_01078.csv')
),

renamed as (
    select
        station_id,
        date::date as date,
        parameter,
        value,
        quality
    from source
)

select * from renamed
  );

[0m23:21:13.309383 [debug] [Thread-1 (]: SQL status: OK in 0.044 seconds
[0m23:21:13.311892 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:21:13.312034 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather" rename to "stg_weather__dbt_backup"
[0m23:21:13.312613 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:21:13.313764 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:21:13.313884 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather__dbt_tmp" rename to "stg_weather"
[0m23:21:13.314085 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:21:13.318215 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:21:13.318341 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:21:13.318444 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:21:13.318844 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:21:13.320611 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:21:13.320725 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

      drop view if exists "weather"."main"."stg_weather__dbt_backup" cascade
    
[0m23:21:13.320950 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:21:13.321859 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: Close
[0m23:21:13.322722 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e55ef5d-ffe4-43e8-89e1-ecf1d45fd87b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c20a9c0>]}
[0m23:21:13.322979 [info ] [Thread-1 (]: 1 of 2 OK created sql view model main.stg_weather .............................. [[32mOK[0m in 0.07s]
[0m23:21:13.323197 [debug] [Thread-1 (]: Finished running node model.dwd_weather.stg_weather
[0m23:21:13.323574 [debug] [Thread-1 (]: Began running node model.dwd_weather.int_weather_features
[0m23:21:13.323819 [info ] [Thread-1 (]: 2 of 2 START sql view model main.int_weather_features .......................... [RUN]
[0m23:21:13.324054 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dwd_weather.stg_weather, now model.dwd_weather.int_weather_features)
[0m23:21:13.324212 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.int_weather_features
[0m23:21:13.325515 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.int_weather_features"
[0m23:21:13.325796 [debug] [Thread-1 (]: Began executing node model.dwd_weather.int_weather_features
[0m23:21:13.326851 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.int_weather_features"
[0m23:21:13.327084 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:21:13.327209 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: BEGIN
[0m23:21:13.327326 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:21:13.327589 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:21:13.327708 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:21:13.327867 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

  
  create view "weather"."main"."int_weather_features__dbt_tmp" as (
    with weather_data as (
    select * from "weather"."main"."stg_weather"
),

pivoted as (
    select
        date,
        max(case when parameter = 'temperature_air_mean_2m' then value end) as temp_mean,
        max(case when parameter = 'temperature_air_max_2m' then value end) as temp_max,
        max(case when parameter = 'temperature_air_min_2m' then value end) as temp_min,
        max(case when parameter = 'wind_speed' then value end) as wind_speed,
        max(case when parameter = 'precipitation_height' then value end) as precipitation,
        max(case when parameter = 'humidity' then value end) as humidity,
        max(case when parameter = 'sunshine_duration' then value end) as sunshine
    from weather_data
    group by date
),

cleaned as (
    select
        date,
        -- Simple interpolation or filling could be done here, but SQL window functions for interpolation are complex.
        -- We will assume data is mostly complete or handle nulls in training.
        -- For now, let's just use the values.
        temp_mean,
        temp_max,
        temp_min,
        wind_speed,
        coalesce(precipitation, 0) as precipitation, -- Assume 0 if null for precip
        humidity,
        sunshine,
        pressure_surface,
        -- Seasonality
        month(date) as month,
        dayofyear(date) as day_of_year,
        case when coalesce(precipitation, 0) > 0 then 1 else 0 end as is_raining
    from pivoted
),

features as (
    select
        *,
        -- Lag features (Past 1 day)
        lag(temp_mean, 1) over (order by date) as temp_mean_lag_1,
        lag(temp_max, 1) over (order by date) as temp_max_lag_1,
        lag(temp_min, 1) over (order by date) as temp_min_lag_1,
        lag(wind_speed, 1) over (order by date) as wind_speed_lag_1,
        lag(humidity, 1) over (order by date) as humidity_lag_1,
        lag(precipitation, 1) over (order by date) as precipitation_lag_1,
        lag(pressure_surface, 1) over (order by date) as pressure_surface_lag_1,

        -- Targets (Next 1 day)
        lead(temp_mean, 1) over (order by date) as target_temp_mean_day_1,
        lead(temp_max, 1) over (order by date) as target_temp_max_day_1,
        lead(temp_min, 1) over (order by date) as target_temp_min_day_1,
        lead(wind_speed, 1) over (order by date) as target_wind_speed_day_1,
        lead(humidity, 1) over (order by date) as target_humidity_day_1,
        lead(pressure_surface, 1) over (order by date) as target_pressure_surface_day_1,
        lead(month, 1) over (order by date) as target_month_day_1,
        lead(day_of_year, 1) over (order by date) as target_day_of_year_day_1,
        lead(is_raining, 1) over (order by date) as target_is_raining_day_1
    from cleaned
)

select * from features
where date < current_date -- Filter out future empty rows if any
  );

[0m23:21:13.367075 [debug] [Thread-1 (]: DuckDB adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

  
  create view "weather"."main"."int_weather_features__dbt_tmp" as (
    with weather_data as (
    select * from "weather"."main"."stg_weather"
),

pivoted as (
    select
        date,
        max(case when parameter = 'temperature_air_mean_2m' then value end) as temp_mean,
        max(case when parameter = 'temperature_air_max_2m' then value end) as temp_max,
        max(case when parameter = 'temperature_air_min_2m' then value end) as temp_min,
        max(case when parameter = 'wind_speed' then value end) as wind_speed,
        max(case when parameter = 'precipitation_height' then value end) as precipitation,
        max(case when parameter = 'humidity' then value end) as humidity,
        max(case when parameter = 'sunshine_duration' then value end) as sunshine
    from weather_data
    group by date
),

cleaned as (
    select
        date,
        -- Simple interpolation or filling could be done here, but SQL window functions for interpolation are complex.
        -- We will assume data is mostly complete or handle nulls in training.
        -- For now, let's just use the values.
        temp_mean,
        temp_max,
        temp_min,
        wind_speed,
        coalesce(precipitation, 0) as precipitation, -- Assume 0 if null for precip
        humidity,
        sunshine,
        pressure_surface,
        -- Seasonality
        month(date) as month,
        dayofyear(date) as day_of_year,
        case when coalesce(precipitation, 0) > 0 then 1 else 0 end as is_raining
    from pivoted
),

features as (
    select
        *,
        -- Lag features (Past 1 day)
        lag(temp_mean, 1) over (order by date) as temp_mean_lag_1,
        lag(temp_max, 1) over (order by date) as temp_max_lag_1,
        lag(temp_min, 1) over (order by date) as temp_min_lag_1,
        lag(wind_speed, 1) over (order by date) as wind_speed_lag_1,
        lag(humidity, 1) over (order by date) as humidity_lag_1,
        lag(precipitation, 1) over (order by date) as precipitation_lag_1,
        lag(pressure_surface, 1) over (order by date) as pressure_surface_lag_1,

        -- Targets (Next 1 day)
        lead(temp_mean, 1) over (order by date) as target_temp_mean_day_1,
        lead(temp_max, 1) over (order by date) as target_temp_max_day_1,
        lead(temp_min, 1) over (order by date) as target_temp_min_day_1,
        lead(wind_speed, 1) over (order by date) as target_wind_speed_day_1,
        lead(humidity, 1) over (order by date) as target_humidity_day_1,
        lead(pressure_surface, 1) over (order by date) as target_pressure_surface_day_1,
        lead(month, 1) over (order by date) as target_month_day_1,
        lead(day_of_year, 1) over (order by date) as target_day_of_year_day_1,
        lead(is_raining, 1) over (order by date) as target_is_raining_day_1
    from cleaned
)

select * from features
where date < current_date -- Filter out future empty rows if any
  );

[0m23:21:13.367319 [debug] [Thread-1 (]: DuckDB adapter: Rolling back transaction.
[0m23:21:13.367491 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: ROLLBACK
[0m23:21:13.373122 [debug] [Thread-1 (]: Failed to rollback 'model.dwd_weather.int_weather_features'
[0m23:21:13.373302 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: Close
[0m23:21:13.375267 [debug] [Thread-1 (]: Runtime Error in model int_weather_features (models/intermediate/int_weather_features.sql)
  Binder Error: Referenced column "pressure_surface" not found in FROM clause!
  Candidate bindings: "precipitation", "temp_max", "sunshine"
  
  LINE 36:         pressure_surface,
                   ^
[0m23:21:13.375547 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1e55ef5d-ffe4-43e8-89e1-ecf1d45fd87b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c144d10>]}
[0m23:21:13.375832 [error] [Thread-1 (]: 2 of 2 ERROR creating sql view model main.int_weather_features ................. [[31mERROR[0m in 0.05s]
[0m23:21:13.376062 [debug] [Thread-1 (]: Finished running node model.dwd_weather.int_weather_features
[0m23:21:13.376246 [debug] [Thread-4 (]: Marking all children of 'model.dwd_weather.int_weather_features' to be skipped because of status 'error'.  Reason: Runtime Error in model int_weather_features (models/intermediate/int_weather_features.sql)
  Binder Error: Referenced column "pressure_surface" not found in FROM clause!
  Candidate bindings: "precipitation", "temp_max", "sunshine"
  
  LINE 36:         pressure_surface,
                   ^.
[0m23:21:13.376847 [debug] [MainThread]: Using duckdb connection "master"
[0m23:21:13.376971 [debug] [MainThread]: On master: BEGIN
[0m23:21:13.377073 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:21:13.377336 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:21:13.377445 [debug] [MainThread]: On master: COMMIT
[0m23:21:13.377546 [debug] [MainThread]: Using duckdb connection "master"
[0m23:21:13.377642 [debug] [MainThread]: On master: COMMIT
[0m23:21:13.377822 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:21:13.377977 [debug] [MainThread]: On master: Close
[0m23:21:13.378138 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:21:13.378239 [debug] [MainThread]: Connection 'model.dwd_weather.int_weather_features' was properly closed.
[0m23:21:13.378354 [info ] [MainThread]: 
[0m23:21:13.378476 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 0.19 seconds (0.19s).
[0m23:21:13.378773 [debug] [MainThread]: Command end result
[0m23:21:13.387556 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:21:13.388292 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:21:13.390986 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/run_results.json
[0m23:21:13.391124 [info ] [MainThread]: 
[0m23:21:13.391266 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m23:21:13.391384 [info ] [MainThread]: 
[0m23:21:13.391524 [error] [MainThread]: [31mFailure in model int_weather_features (models/intermediate/int_weather_features.sql)[0m
[0m23:21:13.391660 [error] [MainThread]:   Runtime Error in model int_weather_features (models/intermediate/int_weather_features.sql)
  Binder Error: Referenced column "pressure_surface" not found in FROM clause!
  Candidate bindings: "precipitation", "temp_max", "sunshine"
  
  LINE 36:         pressure_surface,
                   ^
[0m23:21:13.391764 [info ] [MainThread]: 
[0m23:21:13.391886 [info ] [MainThread]:   compiled code at target/compiled/dwd_weather/models/intermediate/int_weather_features.sql
[0m23:21:13.391984 [info ] [MainThread]: 
[0m23:21:13.392098 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 NO-OP=0 TOTAL=2
[0m23:21:13.393482 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 0.6283031, "process_in_blocks": "0", "process_kernel_time": 0.160339, "process_mem_max_rss": "184008704", "process_out_blocks": "0", "process_user_time": 0.943164}
[0m23:21:13.393638 [debug] [MainThread]: Command `dbt build` failed at 23:21:13.393606 after 0.63 seconds
[0m23:21:13.393787 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd63ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be6c870>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be6ccd0>]}
[0m23:21:13.393909 [debug] [MainThread]: Flushing usage events
[0m23:21:13.841560 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:21:23.571993 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c69c590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d757750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d7579d0>]}


============================== 23:21:23.573977 | 920edf6a-65c5-41ee-b11c-06d68a1e4da6 ==============================
[0m23:21:23.573977 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:21:23.574244 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'log_path': '/Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/logs', 'indirect_selection': 'eager', 'printer_width': '80', 'use_colors': 'True', 'version_check': 'True', 'target_path': 'None', 'quiet': 'False', 'no_print': 'None', 'profiles_dir': '.', 'cache_selected_only': 'False', 'warn_error': 'None', 'invocation_command': 'dbt build --profiles-dir .', 'log_format': 'default', 'fail_fast': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'partial_parse': 'True', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'debug': 'False', 'use_experimental_parser': 'False'}
[0m23:21:23.651414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '920edf6a-65c5-41ee-b11c-06d68a1e4da6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca9cfc0>]}
[0m23:21:23.673096 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '920edf6a-65c5-41ee-b11c-06d68a1e4da6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d603ce0>]}
[0m23:21:23.673893 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m23:21:23.712847 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:21:23.744327 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:21:23.744599 [debug] [MainThread]: Partial parsing: updated file: dwd_weather://models/intermediate/int_weather_features.sql
[0m23:21:23.825368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '920edf6a-65c5-41ee-b11c-06d68a1e4da6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d83f050>]}
[0m23:21:23.845878 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:21:23.846642 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:21:23.877914 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '920edf6a-65c5-41ee-b11c-06d68a1e4da6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dec4050>]}
[0m23:21:23.878133 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:21:23.878885 [info ] [MainThread]: 
[0m23:21:23.879032 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:21:23.879145 [info ] [MainThread]: 
[0m23:21:23.879327 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m23:21:23.881057 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_weather'
[0m23:21:23.899310 [debug] [ThreadPool]: Using duckdb connection "list_weather"
[0m23:21:23.899469 [debug] [ThreadPool]: On list_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"weather"'
    
  
  
[0m23:21:23.899576 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:21:23.904132 [debug] [ThreadPool]: SQL status: OK in 0.005 seconds
[0m23:21:23.904612 [debug] [ThreadPool]: On list_weather: Close
[0m23:21:23.904859 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_weather, now create_weather_main)
[0m23:21:23.905046 [debug] [ThreadPool]: Creating schema "database: "weather"
schema: "main"
"
[0m23:21:23.907421 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:21:23.907535 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='weather'
        and type='sqlite'
    
  
[0m23:21:23.907628 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:21:23.907898 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:21:23.908323 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:21:23.908418 [debug] [ThreadPool]: On create_weather_main: BEGIN
[0m23:21:23.908565 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:21:23.908648 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:21:23.908734 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
    
        create schema if not exists "weather"."main"
    
[0m23:21:23.908930 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:21:23.909264 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:21:23.909371 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:21:23.909462 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:21:23.909616 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:21:23.909708 [debug] [ThreadPool]: On create_weather_main: Close
[0m23:21:23.910081 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_weather_main, now list_weather_main)
[0m23:21:23.912152 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:21:23.912278 [debug] [ThreadPool]: On list_weather_main: BEGIN
[0m23:21:23.912374 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:21:23.912555 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:21:23.912646 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:21:23.912739 [debug] [ThreadPool]: On list_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather_main"} */
select
      'weather' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'weather'
  
[0m23:21:23.916570 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m23:21:23.917013 [debug] [ThreadPool]: On list_weather_main: ROLLBACK
[0m23:21:23.917405 [debug] [ThreadPool]: Failed to rollback 'list_weather_main'
[0m23:21:23.917501 [debug] [ThreadPool]: On list_weather_main: Close
[0m23:21:23.917830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '920edf6a-65c5-41ee-b11c-06d68a1e4da6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d8db3f0>]}
[0m23:21:23.918029 [debug] [MainThread]: Using duckdb connection "master"
[0m23:21:23.918141 [debug] [MainThread]: On master: BEGIN
[0m23:21:23.918232 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:21:23.918411 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:21:23.918500 [debug] [MainThread]: On master: COMMIT
[0m23:21:23.918586 [debug] [MainThread]: Using duckdb connection "master"
[0m23:21:23.918668 [debug] [MainThread]: On master: COMMIT
[0m23:21:23.918822 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:21:23.918931 [debug] [MainThread]: On master: Close
[0m23:21:23.919683 [debug] [Thread-1 (]: Began running node model.dwd_weather.stg_weather
[0m23:21:23.919876 [info ] [Thread-1 (]: 1 of 2 START sql view model main.stg_weather ................................... [RUN]
[0m23:21:23.920067 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_weather_main, now model.dwd_weather.stg_weather)
[0m23:21:23.920188 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.stg_weather
[0m23:21:23.922463 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.stg_weather"
[0m23:21:23.922732 [debug] [Thread-1 (]: Began executing node model.dwd_weather.stg_weather
[0m23:21:23.933501 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.stg_weather"
[0m23:21:23.933744 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:21:23.933863 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: BEGIN
[0m23:21:23.933966 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:21:23.934187 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:21:23.934288 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:21:23.934397 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

  
  create view "weather"."main"."stg_weather__dbt_tmp" as (
    with source as (
    select * from read_csv_auto('/Users/norangmangto/works/data_engineering/dwd_weather_prediction/data/raw/dwd_daily_01078.csv')
),

renamed as (
    select
        station_id,
        date::date as date,
        parameter,
        value,
        quality
    from source
)

select * from renamed
  );

[0m23:21:23.969554 [debug] [Thread-1 (]: SQL status: OK in 0.035 seconds
[0m23:21:23.972349 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:21:23.972511 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather" rename to "stg_weather__dbt_backup"
[0m23:21:23.972795 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:21:23.974039 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:21:23.974151 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather__dbt_tmp" rename to "stg_weather"
[0m23:21:23.974342 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:21:23.980307 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:21:23.980527 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:21:23.980642 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:21:23.981167 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:21:23.983130 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:21:23.983253 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

      drop view if exists "weather"."main"."stg_weather__dbt_backup" cascade
    
[0m23:21:23.983522 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:21:23.984481 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: Close
[0m23:21:23.985114 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '920edf6a-65c5-41ee-b11c-06d68a1e4da6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e2ae9c0>]}
[0m23:21:23.985344 [info ] [Thread-1 (]: 1 of 2 OK created sql view model main.stg_weather .............................. [[32mOK[0m in 0.06s]
[0m23:21:23.985565 [debug] [Thread-1 (]: Finished running node model.dwd_weather.stg_weather
[0m23:21:23.985867 [debug] [Thread-1 (]: Began running node model.dwd_weather.int_weather_features
[0m23:21:23.986062 [info ] [Thread-1 (]: 2 of 2 START sql view model main.int_weather_features .......................... [RUN]
[0m23:21:23.986261 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dwd_weather.stg_weather, now model.dwd_weather.int_weather_features)
[0m23:21:23.986407 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.int_weather_features
[0m23:21:23.987619 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.int_weather_features"
[0m23:21:23.987878 [debug] [Thread-1 (]: Began executing node model.dwd_weather.int_weather_features
[0m23:21:23.989085 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.int_weather_features"
[0m23:21:23.989343 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:21:23.989469 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: BEGIN
[0m23:21:23.989585 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:21:23.989829 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:21:23.989944 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:21:23.990114 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

  
  create view "weather"."main"."int_weather_features__dbt_tmp" as (
    with weather_data as (
    select * from "weather"."main"."stg_weather"
),

pivoted as (
    select
        date,
        max(case when parameter = 'temperature_air_mean_2m' then value end) as temp_mean,
        max(case when parameter = 'temperature_air_max_2m' then value end) as temp_max,
        max(case when parameter = 'temperature_air_min_2m' then value end) as temp_min,
        max(case when parameter = 'wind_speed' then value end) as wind_speed,
        max(case when parameter = 'precipitation_height' then value end) as precipitation,
        max(case when parameter = 'humidity' then value end) as humidity,
        max(case when parameter = 'pressure_air_site' then value end) as pressure_surface,
        max(case when parameter = 'sunshine_duration' then value end) as sunshine
    from weather_data
    group by date
),

cleaned as (
    select
        date,
        -- Simple interpolation or filling could be done here, but SQL window functions for interpolation are complex.
        -- We will assume data is mostly complete or handle nulls in training.
        -- For now, let's just use the values.
        temp_mean,
        temp_max,
        temp_min,
        wind_speed,
        coalesce(precipitation, 0) as precipitation, -- Assume 0 if null for precip
        humidity,
        sunshine,
        pressure_surface,
        -- Seasonality
        month(date) as month,
        dayofyear(date) as day_of_year,
        case when coalesce(precipitation, 0) > 0 then 1 else 0 end as is_raining
    from pivoted
),

features as (
    select
        *,
        -- Lag features (Past 1 day)
        lag(temp_mean, 1) over (order by date) as temp_mean_lag_1,
        lag(temp_max, 1) over (order by date) as temp_max_lag_1,
        lag(temp_min, 1) over (order by date) as temp_min_lag_1,
        lag(wind_speed, 1) over (order by date) as wind_speed_lag_1,
        lag(humidity, 1) over (order by date) as humidity_lag_1,
        lag(precipitation, 1) over (order by date) as precipitation_lag_1,
        lag(pressure_surface, 1) over (order by date) as pressure_surface_lag_1,

        -- Targets (Next 1 day)
        lead(temp_mean, 1) over (order by date) as target_temp_mean_day_1,
        lead(temp_max, 1) over (order by date) as target_temp_max_day_1,
        lead(temp_min, 1) over (order by date) as target_temp_min_day_1,
        lead(wind_speed, 1) over (order by date) as target_wind_speed_day_1,
        lead(humidity, 1) over (order by date) as target_humidity_day_1,
        lead(pressure_surface, 1) over (order by date) as target_pressure_surface_day_1,
        lead(month, 1) over (order by date) as target_month_day_1,
        lead(day_of_year, 1) over (order by date) as target_day_of_year_day_1,
        lead(is_raining, 1) over (order by date) as target_is_raining_day_1
    from cleaned
)

select * from features
where date < current_date -- Filter out future empty rows if any
  );

[0m23:21:24.026015 [debug] [Thread-1 (]: SQL status: OK in 0.036 seconds
[0m23:21:24.027368 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:21:24.027498 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features" rename to "int_weather_features__dbt_backup"
[0m23:21:24.027776 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:21:24.028650 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:21:24.028764 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features__dbt_tmp" rename to "int_weather_features"
[0m23:21:24.029034 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:21:24.029528 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:21:24.029642 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:21:24.029747 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:21:24.030205 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:21:24.030992 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:21:24.031119 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

      drop view if exists "weather"."main"."int_weather_features__dbt_backup" cascade
    
[0m23:21:24.031392 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:21:24.031834 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: Close
[0m23:21:24.032048 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '920edf6a-65c5-41ee-b11c-06d68a1e4da6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e298590>]}
[0m23:21:24.032290 [info ] [Thread-1 (]: 2 of 2 OK created sql view model main.int_weather_features ..................... [[32mOK[0m in 0.05s]
[0m23:21:24.032502 [debug] [Thread-1 (]: Finished running node model.dwd_weather.int_weather_features
[0m23:21:24.032965 [debug] [MainThread]: Using duckdb connection "master"
[0m23:21:24.033083 [debug] [MainThread]: On master: BEGIN
[0m23:21:24.033181 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:21:24.033347 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:21:24.033443 [debug] [MainThread]: On master: COMMIT
[0m23:21:24.033538 [debug] [MainThread]: Using duckdb connection "master"
[0m23:21:24.033632 [debug] [MainThread]: On master: COMMIT
[0m23:21:24.033765 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:21:24.033863 [debug] [MainThread]: On master: Close
[0m23:21:24.033986 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:21:24.034085 [debug] [MainThread]: Connection 'model.dwd_weather.int_weather_features' was properly closed.
[0m23:21:24.034200 [info ] [MainThread]: 
[0m23:21:24.034318 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 0.15 seconds (0.15s).
[0m23:21:24.034602 [debug] [MainThread]: Command end result
[0m23:21:24.043477 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:21:24.044283 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:21:24.046541 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/run_results.json
[0m23:21:24.046657 [info ] [MainThread]: 
[0m23:21:24.046798 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:21:24.046907 [info ] [MainThread]: 
[0m23:21:24.047024 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m23:21:24.048000 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 0.5015722, "process_in_blocks": "0", "process_kernel_time": 0.113239, "process_mem_max_rss": "183517184", "process_out_blocks": "0", "process_user_time": 0.906787}
[0m23:21:24.048157 [debug] [MainThread]: Command `dbt build` succeeded at 23:21:24.048124 after 0.50 seconds
[0m23:21:24.048282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10dd0bac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10defc5f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10defc7d0>]}
[0m23:21:24.048405 [debug] [MainThread]: Flushing usage events
[0m23:21:24.470785 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:30:54.038930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab60590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc1b750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc1b9d0>]}


============================== 23:30:54.041215 | 293d503d-6fc6-4be2-bde4-c693ae8f3e78 ==============================
[0m23:30:54.041215 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:30:54.041472 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '.', 'log_format': 'default', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'no_print': 'None', 'fail_fast': 'False', 'log_path': '/Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/logs', 'version_check': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'introspect': 'True', 'warn_error': 'None', 'empty': 'False', 'invocation_command': 'dbt build --profiles-dir .', 'write_json': 'True', 'printer_width': '80', 'static_parser': 'True', 'quiet': 'False', 'use_experimental_parser': 'False', 'use_colors': 'True'}
[0m23:30:54.127477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '293d503d-6fc6-4be2-bde4-c693ae8f3e78', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af60fc0>]}
[0m23:30:54.148660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '293d503d-6fc6-4be2-bde4-c693ae8f3e78', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bac7ce0>]}
[0m23:30:54.149634 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m23:30:54.188891 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:30:54.227748 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:30:54.227914 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:30:54.237463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '293d503d-6fc6-4be2-bde4-c693ae8f3e78', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd07450>]}
[0m23:30:54.257594 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:30:54.258384 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:30:54.273489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '293d503d-6fc6-4be2-bde4-c693ae8f3e78', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c229b80>]}
[0m23:30:54.273682 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:30:54.274585 [info ] [MainThread]: 
[0m23:30:54.274735 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:30:54.274845 [info ] [MainThread]: 
[0m23:30:54.275047 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m23:30:54.276772 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_weather'
[0m23:30:54.316159 [debug] [ThreadPool]: Using duckdb connection "list_weather"
[0m23:30:54.316388 [debug] [ThreadPool]: On list_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"weather"'
    
  
  
[0m23:30:54.316515 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:30:54.323435 [debug] [ThreadPool]: SQL status: OK in 0.007 seconds
[0m23:30:54.324129 [debug] [ThreadPool]: On list_weather: Close
[0m23:30:54.324627 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_weather, now create_weather_main)
[0m23:30:54.325125 [debug] [ThreadPool]: Creating schema "database: "weather"
schema: "main"
"
[0m23:30:54.331170 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:30:54.331459 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='weather'
        and type='sqlite'
    
  
[0m23:30:54.331600 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:30:54.332089 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:30:54.332644 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:30:54.332747 [debug] [ThreadPool]: On create_weather_main: BEGIN
[0m23:30:54.332913 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:30:54.333008 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:30:54.333107 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
    
        create schema if not exists "weather"."main"
    
[0m23:30:54.333283 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:30:54.333593 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:30:54.333697 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:30:54.333787 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:30:54.333949 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:30:54.334055 [debug] [ThreadPool]: On create_weather_main: Close
[0m23:30:54.334478 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_weather_main, now list_weather_main)
[0m23:30:54.337885 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:30:54.338004 [debug] [ThreadPool]: On list_weather_main: BEGIN
[0m23:30:54.338098 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:30:54.338357 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:30:54.338453 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:30:54.338548 [debug] [ThreadPool]: On list_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather_main"} */
select
      'weather' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'weather'
  
[0m23:30:54.342309 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m23:30:54.342788 [debug] [ThreadPool]: On list_weather_main: ROLLBACK
[0m23:30:54.343536 [debug] [ThreadPool]: Failed to rollback 'list_weather_main'
[0m23:30:54.343644 [debug] [ThreadPool]: On list_weather_main: Close
[0m23:30:54.343945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '293d503d-6fc6-4be2-bde4-c693ae8f3e78', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c2460b0>]}
[0m23:30:54.344106 [debug] [MainThread]: Using duckdb connection "master"
[0m23:30:54.344201 [debug] [MainThread]: On master: BEGIN
[0m23:30:54.344289 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:30:54.344444 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:30:54.344543 [debug] [MainThread]: On master: COMMIT
[0m23:30:54.344644 [debug] [MainThread]: Using duckdb connection "master"
[0m23:30:54.344740 [debug] [MainThread]: On master: COMMIT
[0m23:30:54.344870 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:30:54.344971 [debug] [MainThread]: On master: Close
[0m23:30:54.345953 [debug] [Thread-1 (]: Began running node model.dwd_weather.stg_weather
[0m23:30:54.346129 [info ] [Thread-1 (]: 1 of 2 START sql view model main.stg_weather ................................... [RUN]
[0m23:30:54.346290 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_weather_main, now model.dwd_weather.stg_weather)
[0m23:30:54.346423 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.stg_weather
[0m23:30:54.348643 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.stg_weather"
[0m23:30:54.348909 [debug] [Thread-1 (]: Began executing node model.dwd_weather.stg_weather
[0m23:30:54.384391 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.stg_weather"
[0m23:30:54.384774 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:30:54.384897 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: BEGIN
[0m23:30:54.385009 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:30:54.385253 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:30:54.385359 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:30:54.385471 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

  
  create view "weather"."main"."stg_weather__dbt_tmp" as (
    with source as (
    select * from read_csv_auto('/Users/norangmangto/works/data_engineering/dwd_weather_prediction/data/raw/dwd_daily_01078.csv')
),

renamed as (
    select
        station_id,
        date::date as date,
        parameter,
        value,
        quality
    from source
)

select * from renamed
  );

[0m23:30:54.422208 [debug] [Thread-1 (]: SQL status: OK in 0.037 seconds
[0m23:30:54.424734 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:30:54.424878 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather" rename to "stg_weather__dbt_backup"
[0m23:30:54.425123 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:30:54.426187 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:30:54.426305 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather__dbt_tmp" rename to "stg_weather"
[0m23:30:54.426507 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:30:54.430715 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:30:54.430846 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:30:54.430953 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:30:54.431386 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:30:54.433129 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:30:54.433252 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

      drop view if exists "weather"."main"."stg_weather__dbt_backup" cascade
    
[0m23:30:54.433497 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:30:54.434329 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: Close
[0m23:30:54.435125 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '293d503d-6fc6-4be2-bde4-c693ae8f3e78', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c693790>]}
[0m23:30:54.435354 [info ] [Thread-1 (]: 1 of 2 OK created sql view model main.stg_weather .............................. [[32mOK[0m in 0.09s]
[0m23:30:54.435568 [debug] [Thread-1 (]: Finished running node model.dwd_weather.stg_weather
[0m23:30:54.435869 [debug] [Thread-1 (]: Began running node model.dwd_weather.int_weather_features
[0m23:30:54.436062 [info ] [Thread-1 (]: 2 of 2 START sql view model main.int_weather_features .......................... [RUN]
[0m23:30:54.436237 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dwd_weather.stg_weather, now model.dwd_weather.int_weather_features)
[0m23:30:54.436366 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.int_weather_features
[0m23:30:54.437474 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.int_weather_features"
[0m23:30:54.437700 [debug] [Thread-1 (]: Began executing node model.dwd_weather.int_weather_features
[0m23:30:54.438758 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.int_weather_features"
[0m23:30:54.439001 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:30:54.439128 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: BEGIN
[0m23:30:54.439245 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:30:54.439455 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:30:54.439573 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:30:54.439739 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

  
  create view "weather"."main"."int_weather_features__dbt_tmp" as (
    with weather_data as (
    select * from "weather"."main"."stg_weather"
),

pivoted as (
    select
        date,
        max(case when parameter = 'temperature_air_mean_2m' then value end) as temp_mean,
        max(case when parameter = 'temperature_air_max_2m' then value end) as temp_max,
        max(case when parameter = 'temperature_air_min_2m' then value end) as temp_min,
        max(case when parameter = 'wind_speed' then value end) as wind_speed,
        max(case when parameter = 'precipitation_height' then value end) as precipitation,
        max(case when parameter = 'humidity' then value end) as humidity,
        max(case when parameter = 'pressure_air_site' then value end) as pressure_surface,
        max(case when parameter = 'sunshine_duration' then value end) as sunshine
    from weather_data
    group by date
),

cleaned as (
    select
        date,
        -- Simple interpolation or filling could be done here, but SQL window functions for interpolation are complex.
        -- We will assume data is mostly complete or handle nulls in training.
        -- For now, let's just use the values.
        temp_mean,
        temp_max,
        temp_min,
        wind_speed,
        coalesce(precipitation, 0) as precipitation, -- Assume 0 if null for precip
        humidity,
        sunshine,
        pressure_surface,
        -- Seasonality
        month(date) as month,
        dayofyear(date) as day_of_year,
        case when coalesce(precipitation, 0) > 0 then 1 else 0 end as is_raining
    from pivoted
),

features as (
    select
        *,
        -- Lag features (Past 1 day)
        lag(temp_mean, 1) over (order by date) as temp_mean_lag_1,
        lag(temp_max, 1) over (order by date) as temp_max_lag_1,
        lag(temp_min, 1) over (order by date) as temp_min_lag_1,
        lag(wind_speed, 1) over (order by date) as wind_speed_lag_1,
        lag(humidity, 1) over (order by date) as humidity_lag_1,
        lag(precipitation, 1) over (order by date) as precipitation_lag_1,
        lag(pressure_surface, 1) over (order by date) as pressure_surface_lag_1,

        -- Targets (Next 1 day)
        lead(temp_mean, 1) over (order by date) as target_temp_mean_day_1,
        lead(temp_max, 1) over (order by date) as target_temp_max_day_1,
        lead(temp_min, 1) over (order by date) as target_temp_min_day_1,
        lead(wind_speed, 1) over (order by date) as target_wind_speed_day_1,
        lead(humidity, 1) over (order by date) as target_humidity_day_1,
        lead(pressure_surface, 1) over (order by date) as target_pressure_surface_day_1,
        lead(month, 1) over (order by date) as target_month_day_1,
        lead(day_of_year, 1) over (order by date) as target_day_of_year_day_1,
        lead(is_raining, 1) over (order by date) as target_is_raining_day_1
    from cleaned
)

select * from features
where date < current_date -- Filter out future empty rows if any
  );

[0m23:30:54.476026 [debug] [Thread-1 (]: SQL status: OK in 0.036 seconds
[0m23:30:54.477422 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:30:54.477567 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features" rename to "int_weather_features__dbt_backup"
[0m23:30:54.477853 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:30:54.478727 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:30:54.478847 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features__dbt_tmp" rename to "int_weather_features"
[0m23:30:54.479091 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:30:54.479589 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:30:54.479705 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:30:54.479824 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:30:54.480235 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:30:54.480925 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:30:54.481044 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

      drop view if exists "weather"."main"."int_weather_features__dbt_backup" cascade
    
[0m23:30:54.481295 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:30:54.481874 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: Close
[0m23:30:54.482076 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '293d503d-6fc6-4be2-bde4-c693ae8f3e78', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c23dc10>]}
[0m23:30:54.482303 [info ] [Thread-1 (]: 2 of 2 OK created sql view model main.int_weather_features ..................... [[32mOK[0m in 0.05s]
[0m23:30:54.482510 [debug] [Thread-1 (]: Finished running node model.dwd_weather.int_weather_features
[0m23:30:54.482961 [debug] [MainThread]: Using duckdb connection "master"
[0m23:30:54.483078 [debug] [MainThread]: On master: BEGIN
[0m23:30:54.483177 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:30:54.483335 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:30:54.483434 [debug] [MainThread]: On master: COMMIT
[0m23:30:54.483529 [debug] [MainThread]: Using duckdb connection "master"
[0m23:30:54.483623 [debug] [MainThread]: On master: COMMIT
[0m23:30:54.483770 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:30:54.483880 [debug] [MainThread]: On master: Close
[0m23:30:54.484007 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:30:54.484102 [debug] [MainThread]: Connection 'model.dwd_weather.int_weather_features' was properly closed.
[0m23:30:54.484212 [info ] [MainThread]: 
[0m23:30:54.484331 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m23:30:54.484609 [debug] [MainThread]: Command end result
[0m23:30:54.491957 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:30:54.492715 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:30:54.495027 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/run_results.json
[0m23:30:54.495157 [info ] [MainThread]: 
[0m23:30:54.495296 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:30:54.495402 [info ] [MainThread]: 
[0m23:30:54.495517 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m23:30:54.496481 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 0.48468488, "process_in_blocks": "0", "process_kernel_time": 0.136949, "process_mem_max_rss": "188268544", "process_out_blocks": "0", "process_user_time": 0.851585}
[0m23:30:54.496633 [debug] [MainThread]: Command `dbt build` succeeded at 23:30:54.496602 after 0.48 seconds
[0m23:30:54.496759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c27a8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be194f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be18a50>]}
[0m23:30:54.496875 [debug] [MainThread]: Flushing usage events
[0m23:30:54.945380 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:30:41.629180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1c4590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b287750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b2879d0>]}


============================== 22:30:41.631441 | 01e4fef1-b8eb-466d-a044-379a30f99d4c ==============================
[0m22:30:41.631441 [info ] [MainThread]: Running with dbt=1.10.15
[0m22:30:41.631743 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '.', 'target_path': 'None', 'warn_error': 'None', 'debug': 'False', 'no_print': 'None', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'invocation_command': 'dbt build --profiles-dir .', 'quiet': 'False', 'printer_width': '80', 'log_path': '/Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/logs', 'log_format': 'default', 'version_check': 'True', 'introspect': 'True', 'fail_fast': 'False', 'static_parser': 'True', 'partial_parse': 'True', 'write_json': 'True', 'use_colors': 'True', 'log_cache_events': 'False'}
[0m22:30:41.721466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '01e4fef1-b8eb-466d-a044-379a30f99d4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5c8fc0>]}
[0m22:30:41.742534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '01e4fef1-b8eb-466d-a044-379a30f99d4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b133790>]}
[0m22:30:41.743410 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m22:30:41.782357 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m22:30:41.826184 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:30:41.826352 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:30:41.836294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '01e4fef1-b8eb-466d-a044-379a30f99d4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b375f50>]}
[0m22:30:41.856388 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m22:30:41.857334 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m22:30:41.872815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '01e4fef1-b8eb-466d-a044-379a30f99d4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b891d60>]}
[0m22:30:41.873008 [info ] [MainThread]: Found 2 models, 468 macros
[0m22:30:41.873931 [info ] [MainThread]: 
[0m22:30:41.874071 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m22:30:41.874182 [info ] [MainThread]: 
[0m22:30:41.874381 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m22:30:41.876081 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_weather'
[0m22:30:41.912620 [debug] [ThreadPool]: Using duckdb connection "list_weather"
[0m22:30:41.912835 [debug] [ThreadPool]: On list_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"weather"'
    
  
  
[0m22:30:41.912964 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:30:41.919061 [debug] [ThreadPool]: SQL status: OK in 0.006 seconds
[0m22:30:41.919738 [debug] [ThreadPool]: On list_weather: Close
[0m22:30:41.920032 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_weather, now create_weather_main)
[0m22:30:41.920208 [debug] [ThreadPool]: Creating schema "database: "weather"
schema: "main"
"
[0m22:30:41.923208 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m22:30:41.923345 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='weather'
        and type='sqlite'
    
  
[0m22:30:41.923450 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:30:41.923826 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m22:30:41.924332 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m22:30:41.924430 [debug] [ThreadPool]: On create_weather_main: BEGIN
[0m22:30:41.924581 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m22:30:41.924676 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m22:30:41.924773 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
    
        create schema if not exists "weather"."main"
    
[0m22:30:41.924945 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m22:30:41.925251 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m22:30:41.925360 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m22:30:41.925454 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m22:30:41.925591 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m22:30:41.925692 [debug] [ThreadPool]: On create_weather_main: Close
[0m22:30:41.926092 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_weather_main, now list_weather_main)
[0m22:30:41.929589 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m22:30:41.929751 [debug] [ThreadPool]: On list_weather_main: BEGIN
[0m22:30:41.929880 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:30:41.930110 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m22:30:41.930224 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m22:30:41.930335 [debug] [ThreadPool]: On list_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather_main"} */
select
      'weather' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'weather'
  
[0m22:30:41.934108 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m22:30:41.934596 [debug] [ThreadPool]: On list_weather_main: ROLLBACK
[0m22:30:41.935404 [debug] [ThreadPool]: Failed to rollback 'list_weather_main'
[0m22:30:41.935514 [debug] [ThreadPool]: On list_weather_main: Close
[0m22:30:41.935892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '01e4fef1-b8eb-466d-a044-379a30f99d4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8ba0b0>]}
[0m22:30:41.936075 [debug] [MainThread]: Using duckdb connection "master"
[0m22:30:41.936184 [debug] [MainThread]: On master: BEGIN
[0m22:30:41.936278 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:30:41.936464 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m22:30:41.936565 [debug] [MainThread]: On master: COMMIT
[0m22:30:41.936658 [debug] [MainThread]: Using duckdb connection "master"
[0m22:30:41.936747 [debug] [MainThread]: On master: COMMIT
[0m22:30:41.936912 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m22:30:41.937036 [debug] [MainThread]: On master: Close
[0m22:30:41.938126 [debug] [Thread-1 (]: Began running node model.dwd_weather.stg_weather
[0m22:30:41.938329 [info ] [Thread-1 (]: 1 of 2 START sql view model main.stg_weather ................................... [RUN]
[0m22:30:41.938500 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_weather_main, now model.dwd_weather.stg_weather)
[0m22:30:41.938631 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.stg_weather
[0m22:30:41.940949 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.stg_weather"
[0m22:30:41.941218 [debug] [Thread-1 (]: Began executing node model.dwd_weather.stg_weather
[0m22:30:41.975986 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.stg_weather"
[0m22:30:41.976401 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m22:30:41.976528 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: BEGIN
[0m22:30:41.976639 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:30:41.976907 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m22:30:41.977014 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m22:30:41.977127 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

  
  create view "weather"."main"."stg_weather__dbt_tmp" as (
    with source as (
    select * from read_csv_auto('/Users/norangmangto/works/data_engineering/dwd_weather_prediction/data/raw/dwd_daily_01078.csv')
),

renamed as (
    select
        station_id,
        date::date as date,
        parameter,
        value,
        quality
    from source
)

select * from renamed
  );

[0m22:30:42.012605 [debug] [Thread-1 (]: SQL status: OK in 0.035 seconds
[0m22:30:42.015044 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m22:30:42.015182 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather" rename to "stg_weather__dbt_backup"
[0m22:30:42.015430 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m22:30:42.016468 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m22:30:42.016588 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather__dbt_tmp" rename to "stg_weather"
[0m22:30:42.016784 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m22:30:42.020865 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m22:30:42.020993 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m22:30:42.021099 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m22:30:42.021480 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m22:30:42.023148 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m22:30:42.023263 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

      drop view if exists "weather"."main"."stg_weather__dbt_backup" cascade
    
[0m22:30:42.023496 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m22:30:42.024336 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: Close
[0m22:30:42.025144 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01e4fef1-b8eb-466d-a044-379a30f99d4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc47790>]}
[0m22:30:42.025390 [info ] [Thread-1 (]: 1 of 2 OK created sql view model main.stg_weather .............................. [[32mOK[0m in 0.09s]
[0m22:30:42.025607 [debug] [Thread-1 (]: Finished running node model.dwd_weather.stg_weather
[0m22:30:42.025903 [debug] [Thread-1 (]: Began running node model.dwd_weather.int_weather_features
[0m22:30:42.026094 [info ] [Thread-1 (]: 2 of 2 START sql view model main.int_weather_features .......................... [RUN]
[0m22:30:42.026338 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dwd_weather.stg_weather, now model.dwd_weather.int_weather_features)
[0m22:30:42.026501 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.int_weather_features
[0m22:30:42.027805 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.int_weather_features"
[0m22:30:42.028086 [debug] [Thread-1 (]: Began executing node model.dwd_weather.int_weather_features
[0m22:30:42.029292 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.int_weather_features"
[0m22:30:42.029575 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m22:30:42.029704 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: BEGIN
[0m22:30:42.029824 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:30:42.030070 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m22:30:42.030197 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m22:30:42.030369 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

  
  create view "weather"."main"."int_weather_features__dbt_tmp" as (
    with weather_data as (
    select * from "weather"."main"."stg_weather"
),

pivoted as (
    select
        date,
        max(case when parameter = 'temperature_air_mean_2m' then value end) as temp_mean,
        max(case when parameter = 'temperature_air_max_2m' then value end) as temp_max,
        max(case when parameter = 'temperature_air_min_2m' then value end) as temp_min,
        max(case when parameter = 'wind_speed' then value end) as wind_speed,
        max(case when parameter = 'precipitation_height' then value end) as precipitation,
        max(case when parameter = 'humidity' then value end) as humidity,
        max(case when parameter = 'pressure_air_site' then value end) as pressure_surface,
        max(case when parameter = 'sunshine_duration' then value end) as sunshine
    from weather_data
    group by date
),

cleaned as (
    select
        date,
        -- Simple interpolation or filling could be done here, but SQL window functions for interpolation are complex.
        -- We will assume data is mostly complete or handle nulls in training.
        -- For now, let's just use the values.
        temp_mean,
        temp_max,
        temp_min,
        wind_speed,
        coalesce(precipitation, 0) as precipitation, -- Assume 0 if null for precip
        humidity,
        sunshine,
        pressure_surface,
        -- Seasonality
        month(date) as month,
        dayofyear(date) as day_of_year,
        case when coalesce(precipitation, 0) > 0 then 1 else 0 end as is_raining
    from pivoted
),

features as (
    select
        *,
        -- Lag features (Past 1 day)
        lag(temp_mean, 1) over (order by date) as temp_mean_lag_1,
        lag(temp_max, 1) over (order by date) as temp_max_lag_1,
        lag(temp_min, 1) over (order by date) as temp_min_lag_1,
        lag(wind_speed, 1) over (order by date) as wind_speed_lag_1,
        lag(humidity, 1) over (order by date) as humidity_lag_1,
        lag(precipitation, 1) over (order by date) as precipitation_lag_1,
        lag(pressure_surface, 1) over (order by date) as pressure_surface_lag_1,

        -- Targets (Next 1 day)
        lead(temp_mean, 1) over (order by date) as target_temp_mean_day_1,
        lead(temp_max, 1) over (order by date) as target_temp_max_day_1,
        lead(temp_min, 1) over (order by date) as target_temp_min_day_1,
        lead(wind_speed, 1) over (order by date) as target_wind_speed_day_1,
        lead(humidity, 1) over (order by date) as target_humidity_day_1,
        lead(pressure_surface, 1) over (order by date) as target_pressure_surface_day_1,
        lead(month, 1) over (order by date) as target_month_day_1,
        lead(day_of_year, 1) over (order by date) as target_day_of_year_day_1,
        lead(is_raining, 1) over (order by date) as target_is_raining_day_1
    from cleaned
)

select * from features
where date < current_date -- Filter out future empty rows if any
  );

[0m22:30:42.065800 [debug] [Thread-1 (]: SQL status: OK in 0.035 seconds
[0m22:30:42.067191 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m22:30:42.067336 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features" rename to "int_weather_features__dbt_backup"
[0m22:30:42.067629 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m22:30:42.068539 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m22:30:42.068657 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features__dbt_tmp" rename to "int_weather_features"
[0m22:30:42.068885 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m22:30:42.069375 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m22:30:42.069491 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m22:30:42.069594 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m22:30:42.070055 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m22:30:42.070773 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m22:30:42.070889 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

      drop view if exists "weather"."main"."int_weather_features__dbt_backup" cascade
    
[0m22:30:42.071149 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m22:30:42.071723 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: Close
[0m22:30:42.071919 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '01e4fef1-b8eb-466d-a044-379a30f99d4c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8a9b50>]}
[0m22:30:42.072139 [info ] [Thread-1 (]: 2 of 2 OK created sql view model main.int_weather_features ..................... [[32mOK[0m in 0.05s]
[0m22:30:42.072357 [debug] [Thread-1 (]: Finished running node model.dwd_weather.int_weather_features
[0m22:30:42.072823 [debug] [MainThread]: Using duckdb connection "master"
[0m22:30:42.072937 [debug] [MainThread]: On master: BEGIN
[0m22:30:42.073034 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:30:42.073189 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m22:30:42.073289 [debug] [MainThread]: On master: COMMIT
[0m22:30:42.073387 [debug] [MainThread]: Using duckdb connection "master"
[0m22:30:42.073484 [debug] [MainThread]: On master: COMMIT
[0m22:30:42.073650 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m22:30:42.073812 [debug] [MainThread]: On master: Close
[0m22:30:42.073975 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:30:42.074074 [debug] [MainThread]: Connection 'model.dwd_weather.int_weather_features' was properly closed.
[0m22:30:42.074198 [info ] [MainThread]: 
[0m22:30:42.074321 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m22:30:42.074619 [debug] [MainThread]: Command end result
[0m22:30:42.081911 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m22:30:42.082613 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m22:30:42.085026 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/run_results.json
[0m22:30:42.085136 [info ] [MainThread]: 
[0m22:30:42.085271 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:30:42.085378 [info ] [MainThread]: 
[0m22:30:42.085496 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m22:30:42.086498 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 0.48423234, "process_in_blocks": "0", "process_kernel_time": 0.141822, "process_mem_max_rss": "180682752", "process_out_blocks": "0", "process_user_time": 0.845793}
[0m22:30:42.086649 [debug] [MainThread]: Command `dbt build` succeeded at 22:30:42.086619 after 0.48 seconds
[0m22:30:42.086775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8c38b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b487110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b484c30>]}
[0m22:30:42.086893 [debug] [MainThread]: Flushing usage events
[0m22:30:42.542756 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:02:44.483600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10876c590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10982f750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10982f9d0>]}


============================== 23:02:44.486020 | 4b92da49-7b5e-4590-842a-d14b303d53a8 ==============================
[0m23:02:44.486020 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:02:44.486324 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'introspect': 'True', 'warn_error': 'None', 'log_format': 'default', 'fail_fast': 'False', 'log_cache_events': 'False', 'version_check': 'True', 'quiet': 'False', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'printer_width': '80', 'cache_selected_only': 'False', 'debug': 'False', 'indirect_selection': 'eager', 'profiles_dir': '/Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'use_colors': 'True', 'invocation_command': 'dbt debug', 'empty': 'None', 'target_path': 'None', 'log_path': '/Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/logs'}
[0m23:02:44.495219 [info ] [MainThread]: dbt version: 1.10.15
[0m23:02:44.495385 [info ] [MainThread]: python version: 3.13.2
[0m23:02:44.495500 [info ] [MainThread]: python path: /Users/norangmangto/works/data_engineering/dwd_weather_prediction/.venv/bin/python3
[0m23:02:44.495603 [info ] [MainThread]: os info: macOS-26.1-arm64-arm-64bit-Mach-O
[0m23:02:44.539754 [info ] [MainThread]: Using profiles dir at /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform
[0m23:02:44.540003 [info ] [MainThread]: Using profiles.yml file at /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/profiles.yml
[0m23:02:44.540259 [info ] [MainThread]: Using dbt_project.yml file at /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/dbt_project.yml
[0m23:02:44.541423 [info ] [MainThread]: adapter type: duckdb
[0m23:02:44.541597 [info ] [MainThread]: adapter version: 1.10.0
[0m23:02:44.626515 [info ] [MainThread]: Configuration:
[0m23:02:44.626930 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m23:02:44.627223 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m23:02:44.627449 [info ] [MainThread]: Required dependencies:
[0m23:02:44.627763 [debug] [MainThread]: Executing "git --help"
[0m23:02:44.639955 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--no-lazy-fetch]\n           [--no-optional-locks] [--no-advice] [--bare] [--git-dir=<path>]\n           [--work-tree=<path>] [--namespace=<name>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone      Clone a repository into a new directory\n   init       Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add        Add file contents to the index\n   mv         Move or rename a file, a directory, or a symlink\n   restore    Restore working tree files\n   rm         Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect     Use binary search to find the commit that introduced a bug\n   diff       Show changes between commits, commit and working tree, etc\n   grep       Print lines matching a pattern\n   log        Show commit logs\n   show       Show various types of objects\n   status     Show the working tree status\n\ngrow, mark and tweak your common history\n   backfill   Download missing objects in a partial clone\n   branch     List, create, or delete branches\n   commit     Record changes to the repository\n   merge      Join two or more development histories together\n   rebase     Reapply commits on top of another base tip\n   reset      Reset current HEAD to the specified state\n   switch     Switch branches\n   tag        Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch      Download objects and refs from another repository\n   pull       Fetch from and integrate with another repository or a local branch\n   push       Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m23:02:44.640377 [debug] [MainThread]: STDERR: "b''"
[0m23:02:44.640518 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m23:02:44.640656 [info ] [MainThread]: Connection:
[0m23:02:44.640812 [info ] [MainThread]:   database: weather
[0m23:02:44.640917 [info ] [MainThread]:   schema: main
[0m23:02:44.641018 [info ] [MainThread]:   path: ../data/processed/weather.duckdb
[0m23:02:44.641118 [info ] [MainThread]:   config_options: None
[0m23:02:44.641221 [info ] [MainThread]:   extensions: ['parquet']
[0m23:02:44.641321 [info ] [MainThread]:   settings: {}
[0m23:02:44.641417 [info ] [MainThread]:   external_root: .
[0m23:02:44.641519 [info ] [MainThread]:   use_credential_provider: None
[0m23:02:44.641620 [info ] [MainThread]:   attach: None
[0m23:02:44.641718 [info ] [MainThread]:   filesystems: None
[0m23:02:44.641812 [info ] [MainThread]:   remote: None
[0m23:02:44.641910 [info ] [MainThread]:   plugins: None
[0m23:02:44.642006 [info ] [MainThread]:   disable_transactions: False
[0m23:02:44.642259 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m23:02:44.680517 [debug] [MainThread]: Acquiring new duckdb connection 'debug'
[0m23:02:44.709923 [debug] [MainThread]: Using duckdb connection "debug"
[0m23:02:44.710129 [debug] [MainThread]: On debug: select 1 as id
[0m23:02:44.710251 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:02:44.715316 [debug] [MainThread]: SQL status: OK in 0.005 seconds
[0m23:02:44.715749 [debug] [MainThread]: On debug: Close
[0m23:02:44.715886 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m23:02:44.716020 [info ] [MainThread]: [32mAll checks passed![0m
[0m23:02:44.721418 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 0.26476938, "process_in_blocks": "0", "process_kernel_time": 0.134108, "process_mem_max_rss": "141230080", "process_out_blocks": "0", "process_user_time": 0.66842}
[0m23:02:44.721701 [debug] [MainThread]: Command `dbt debug` succeeded at 23:02:44.721650 after 0.27 seconds
[0m23:02:44.721950 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m23:02:44.722117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109dd5480>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b3a570>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109926030>]}
[0m23:02:44.722325 [debug] [MainThread]: Flushing usage events
[0m23:02:45.173553 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m23:03:19.545455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2f8590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3bb750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3bb9d0>]}


============================== 23:03:19.547277 | 6e2dda5b-c7ee-4644-a337-0741a120463b ==============================
[0m23:03:19.547277 [info ] [MainThread]: Running with dbt=1.10.15
[0m23:03:19.547540 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '/Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform', 'debug': 'False', 'use_colors': 'True', 'fail_fast': 'False', 'empty': 'False', 'printer_width': '80', 'quiet': 'False', 'write_json': 'True', 'warn_error': 'None', 'introspect': 'True', 'version_check': 'True', 'cache_selected_only': 'False', 'static_parser': 'True', 'invocation_command': 'dbt run', 'log_path': '/Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/logs', 'target_path': 'None', 'log_format': 'default', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False'}
[0m23:03:19.630529 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6e2dda5b-c7ee-4644-a337-0741a120463b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a708fc0>]}
[0m23:03:19.652539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6e2dda5b-c7ee-4644-a337-0741a120463b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b267790>]}
[0m23:03:19.653391 [info ] [MainThread]: Registered adapter: duckdb=1.10.0
[0m23:03:19.691102 [debug] [MainThread]: checksum: 14a228079bd6df63ba81633f9a3cf44ecfaa31056ac397c602753ec895dbf885, vars: {}, profile: , target: , version: 1.10.15
[0m23:03:19.732066 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m23:03:19.732391 [debug] [MainThread]: Partial parsing: updated file: dwd_weather://models/intermediate/int_weather_features.sql
[0m23:03:19.817013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6e2dda5b-c7ee-4644-a337-0741a120463b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4a6e50>]}
[0m23:03:19.859826 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:03:19.860694 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:03:19.866989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6e2dda5b-c7ee-4644-a337-0741a120463b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e5b890>]}
[0m23:03:19.867169 [info ] [MainThread]: Found 2 models, 468 macros
[0m23:03:19.867307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6e2dda5b-c7ee-4644-a337-0741a120463b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6197f0>]}
[0m23:03:19.868020 [info ] [MainThread]: 
[0m23:03:19.868156 [info ] [MainThread]: Concurrency: 1 threads (target='dev')
[0m23:03:19.868261 [info ] [MainThread]: 
[0m23:03:19.868454 [debug] [MainThread]: Acquiring new duckdb connection 'master'
[0m23:03:19.870587 [debug] [ThreadPool]: Acquiring new duckdb connection 'list_weather'
[0m23:03:19.891681 [debug] [ThreadPool]: Using duckdb connection "list_weather"
[0m23:03:19.891851 [debug] [ThreadPool]: On list_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather"} */

    
    select schema_name
    from system.information_schema.schemata
    
    where lower(catalog_name) = '"weather"'
    
  
  
[0m23:03:19.891958 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:03:19.896468 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m23:03:19.896949 [debug] [ThreadPool]: On list_weather: Close
[0m23:03:19.897201 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_weather, now create_weather_main)
[0m23:03:19.897359 [debug] [ThreadPool]: Creating schema "database: "weather"
schema: "main"
"
[0m23:03:19.899701 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:03:19.899817 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
        select type from duckdb_databases()
        where lower(database_name)='weather'
        and type='sqlite'
    
  
[0m23:03:19.899909 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:03:19.900167 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:03:19.900594 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:03:19.900687 [debug] [ThreadPool]: On create_weather_main: BEGIN
[0m23:03:19.900830 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:03:19.900917 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:03:19.901003 [debug] [ThreadPool]: On create_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "create_weather_main"} */

    
    
        create schema if not exists "weather"."main"
    
[0m23:03:19.901159 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:03:19.901429 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:03:19.901525 [debug] [ThreadPool]: Using duckdb connection "create_weather_main"
[0m23:03:19.901612 [debug] [ThreadPool]: On create_weather_main: COMMIT
[0m23:03:19.901778 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:03:19.901921 [debug] [ThreadPool]: On create_weather_main: Close
[0m23:03:19.902304 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_weather_main, now list_weather_main)
[0m23:03:19.904803 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:03:19.904956 [debug] [ThreadPool]: On list_weather_main: BEGIN
[0m23:03:19.905057 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m23:03:19.905266 [debug] [ThreadPool]: SQL status: OK in 0.000 seconds
[0m23:03:19.905359 [debug] [ThreadPool]: Using duckdb connection "list_weather_main"
[0m23:03:19.905454 [debug] [ThreadPool]: On list_weather_main: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "connection_name": "list_weather_main"} */
select
      'weather' as database,
      table_name as name,
      table_schema as schema,
      CASE table_type
        WHEN 'BASE TABLE' THEN 'table'
        WHEN 'VIEW' THEN 'view'
        WHEN 'LOCAL TEMPORARY' THEN 'table'
        END as type
    from system.information_schema.tables
    where lower(table_schema) = 'main'
    and lower(table_catalog) = 'weather'
  
[0m23:03:19.909155 [debug] [ThreadPool]: SQL status: OK in 0.004 seconds
[0m23:03:19.909637 [debug] [ThreadPool]: On list_weather_main: ROLLBACK
[0m23:03:19.910391 [debug] [ThreadPool]: Failed to rollback 'list_weather_main'
[0m23:03:19.910496 [debug] [ThreadPool]: On list_weather_main: Close
[0m23:03:19.910814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6e2dda5b-c7ee-4644-a337-0741a120463b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bd9d160>]}
[0m23:03:19.910966 [debug] [MainThread]: Using duckdb connection "master"
[0m23:03:19.911057 [debug] [MainThread]: On master: BEGIN
[0m23:03:19.911143 [debug] [MainThread]: Opening a new connection, currently in state init
[0m23:03:19.911302 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:03:19.911394 [debug] [MainThread]: On master: COMMIT
[0m23:03:19.911479 [debug] [MainThread]: Using duckdb connection "master"
[0m23:03:19.911562 [debug] [MainThread]: On master: COMMIT
[0m23:03:19.911719 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:03:19.911835 [debug] [MainThread]: On master: Close
[0m23:03:19.912907 [debug] [Thread-1 (]: Began running node model.dwd_weather.stg_weather
[0m23:03:19.913124 [info ] [Thread-1 (]: 1 of 2 START sql view model main.stg_weather ................................... [RUN]
[0m23:03:19.913302 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_weather_main, now model.dwd_weather.stg_weather)
[0m23:03:19.913432 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.stg_weather
[0m23:03:19.915565 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.stg_weather"
[0m23:03:19.915813 [debug] [Thread-1 (]: Began executing node model.dwd_weather.stg_weather
[0m23:03:19.927608 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.stg_weather"
[0m23:03:19.928008 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:03:19.928156 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: BEGIN
[0m23:03:19.928282 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:03:19.928593 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:03:19.928761 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:03:19.928911 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

  
  create view "weather"."main"."stg_weather__dbt_tmp" as (
    with source as (
    select * from read_csv_auto('/Users/norangmangto/works/data_engineering/dwd_weather_prediction/data/raw/dwd_daily_01078.csv')
),

renamed as (
    select
        station_id,
        date::date as date,
        parameter,
        value,
        quality
    from source
)

select * from renamed
  );

[0m23:03:19.980501 [debug] [Thread-1 (]: SQL status: OK in 0.051 seconds
[0m23:03:19.983028 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:03:19.983177 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather" rename to "stg_weather__dbt_backup"
[0m23:03:19.983430 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:03:19.984488 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:03:19.984603 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */
alter view "weather"."main"."stg_weather__dbt_tmp" rename to "stg_weather"
[0m23:03:19.984796 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:03:19.989219 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:03:19.989372 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:03:19.989496 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: COMMIT
[0m23:03:19.990126 [debug] [Thread-1 (]: SQL status: OK in 0.001 seconds
[0m23:03:19.991919 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.stg_weather"
[0m23:03:19.992041 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.stg_weather"} */

      drop view if exists "weather"."main"."stg_weather__dbt_backup" cascade
    
[0m23:03:19.992281 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:03:19.993176 [debug] [Thread-1 (]: On model.dwd_weather.stg_weather: Close
[0m23:03:19.994015 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e2dda5b-c7ee-4644-a337-0741a120463b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bae2090>]}
[0m23:03:19.994248 [info ] [Thread-1 (]: 1 of 2 OK created sql view model main.stg_weather .............................. [[32mOK[0m in 0.08s]
[0m23:03:19.994464 [debug] [Thread-1 (]: Finished running node model.dwd_weather.stg_weather
[0m23:03:19.994745 [debug] [Thread-1 (]: Began running node model.dwd_weather.int_weather_features
[0m23:03:19.994944 [info ] [Thread-1 (]: 2 of 2 START sql view model main.int_weather_features .......................... [RUN]
[0m23:03:19.995121 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.dwd_weather.stg_weather, now model.dwd_weather.int_weather_features)
[0m23:03:19.995256 [debug] [Thread-1 (]: Began compiling node model.dwd_weather.int_weather_features
[0m23:03:19.996874 [debug] [Thread-1 (]: Writing injected SQL for node "model.dwd_weather.int_weather_features"
[0m23:03:19.997121 [debug] [Thread-1 (]: Began executing node model.dwd_weather.int_weather_features
[0m23:03:19.998095 [debug] [Thread-1 (]: Writing runtime sql for node "model.dwd_weather.int_weather_features"
[0m23:03:19.998308 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:03:19.998419 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: BEGIN
[0m23:03:19.998524 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m23:03:19.998715 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:03:19.998833 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:03:19.999050 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

  
  create view "weather"."main"."int_weather_features__dbt_tmp" as (
    with weather_data as (
    select * from "weather"."main"."stg_weather"
),

pivoted as (
    select
        date,
        max(case when parameter = 'temperature_air_mean_2m' then value end) as temp_mean,
        max(case when parameter = 'temperature_air_max_2m' then value end) as temp_max,
        max(case when parameter = 'temperature_air_min_2m' then value end) as temp_min,
        max(case when parameter = 'wind_speed' then value end) as wind_speed,
        max(case when parameter = 'precipitation_height' then value end) as precipitation,
        max(case when parameter = 'humidity' then value end) as humidity,
        max(case when parameter = 'pressure_air_site' then value end) as pressure_surface,
        max(case when parameter = 'sunshine_duration' then value end) as sunshine
    from weather_data
    group by date
),

cleaned as (
    select
        date,
        -- Simple interpolation or filling could be done here, but SQL window functions for interpolation are complex.
        -- We will assume data is mostly complete or handle nulls in training.
        -- For now, let's just use the values.
        temp_mean,
        temp_max,
        temp_min,
        wind_speed,
        coalesce(precipitation, 0) as precipitation, -- Assume 0 if null for precip
        humidity,
        sunshine,
        pressure_surface,
        -- Seasonality
        month(date) as month,
        dayofyear(date) as day_of_year,
        case when coalesce(precipitation, 0) > 0 then 1 else 0 end as is_raining
    from pivoted
),

features as (
    select
        *,
        -- Lag features (Past 1 day)
        lag(temp_mean, 1) over (order by date) as temp_mean_lag_1,
        lag(temp_max, 1) over (order by date) as temp_max_lag_1,
        lag(temp_min, 1) over (order by date) as temp_min_lag_1,
        lag(wind_speed, 1) over (order by date) as wind_speed_lag_1,
        lag(humidity, 1) over (order by date) as humidity_lag_1,
        lag(precipitation, 1) over (order by date) as precipitation_lag_1,
        lag(pressure_surface, 1) over (order by date) as pressure_surface_lag_1,

        -- Targets (Next 1 day)
        -- Targets (Next 7 days)
        
        lead(temp_mean, 1) over (order by date) as target_temp_mean_day_1,
        lead(temp_max, 1) over (order by date) as target_temp_max_day_1,
        lead(temp_min, 1) over (order by date) as target_temp_min_day_1,
        lead(wind_speed, 1) over (order by date) as target_wind_speed_day_1,
        lead(humidity, 1) over (order by date) as target_humidity_day_1,
        lead(pressure_surface, 1) over (order by date) as target_pressure_surface_day_1,
        lead(is_raining, 1) over (order by date) as target_is_raining_day_1,
        
        lead(temp_mean, 2) over (order by date) as target_temp_mean_day_2,
        lead(temp_max, 2) over (order by date) as target_temp_max_day_2,
        lead(temp_min, 2) over (order by date) as target_temp_min_day_2,
        lead(wind_speed, 2) over (order by date) as target_wind_speed_day_2,
        lead(humidity, 2) over (order by date) as target_humidity_day_2,
        lead(pressure_surface, 2) over (order by date) as target_pressure_surface_day_2,
        lead(is_raining, 2) over (order by date) as target_is_raining_day_2,
        
        lead(temp_mean, 3) over (order by date) as target_temp_mean_day_3,
        lead(temp_max, 3) over (order by date) as target_temp_max_day_3,
        lead(temp_min, 3) over (order by date) as target_temp_min_day_3,
        lead(wind_speed, 3) over (order by date) as target_wind_speed_day_3,
        lead(humidity, 3) over (order by date) as target_humidity_day_3,
        lead(pressure_surface, 3) over (order by date) as target_pressure_surface_day_3,
        lead(is_raining, 3) over (order by date) as target_is_raining_day_3,
        
        lead(temp_mean, 4) over (order by date) as target_temp_mean_day_4,
        lead(temp_max, 4) over (order by date) as target_temp_max_day_4,
        lead(temp_min, 4) over (order by date) as target_temp_min_day_4,
        lead(wind_speed, 4) over (order by date) as target_wind_speed_day_4,
        lead(humidity, 4) over (order by date) as target_humidity_day_4,
        lead(pressure_surface, 4) over (order by date) as target_pressure_surface_day_4,
        lead(is_raining, 4) over (order by date) as target_is_raining_day_4,
        
        lead(temp_mean, 5) over (order by date) as target_temp_mean_day_5,
        lead(temp_max, 5) over (order by date) as target_temp_max_day_5,
        lead(temp_min, 5) over (order by date) as target_temp_min_day_5,
        lead(wind_speed, 5) over (order by date) as target_wind_speed_day_5,
        lead(humidity, 5) over (order by date) as target_humidity_day_5,
        lead(pressure_surface, 5) over (order by date) as target_pressure_surface_day_5,
        lead(is_raining, 5) over (order by date) as target_is_raining_day_5,
        
        lead(temp_mean, 6) over (order by date) as target_temp_mean_day_6,
        lead(temp_max, 6) over (order by date) as target_temp_max_day_6,
        lead(temp_min, 6) over (order by date) as target_temp_min_day_6,
        lead(wind_speed, 6) over (order by date) as target_wind_speed_day_6,
        lead(humidity, 6) over (order by date) as target_humidity_day_6,
        lead(pressure_surface, 6) over (order by date) as target_pressure_surface_day_6,
        lead(is_raining, 6) over (order by date) as target_is_raining_day_6,
        
        lead(temp_mean, 7) over (order by date) as target_temp_mean_day_7,
        lead(temp_max, 7) over (order by date) as target_temp_max_day_7,
        lead(temp_min, 7) over (order by date) as target_temp_min_day_7,
        lead(wind_speed, 7) over (order by date) as target_wind_speed_day_7,
        lead(humidity, 7) over (order by date) as target_humidity_day_7,
        lead(pressure_surface, 7) over (order by date) as target_pressure_surface_day_7,
        lead(is_raining, 7) over (order by date) as target_is_raining_day_7,
        
    from cleaned
)

select * from features
where date < current_date -- Filter out future empty rows if any
  );

[0m23:03:20.035391 [debug] [Thread-1 (]: SQL status: OK in 0.036 seconds
[0m23:03:20.036895 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:03:20.037079 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features" rename to "int_weather_features__dbt_backup"
[0m23:03:20.037435 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:03:20.038994 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:03:20.039139 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */
alter view "weather"."main"."int_weather_features__dbt_tmp" rename to "int_weather_features"
[0m23:03:20.039471 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:03:20.040023 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:03:20.040141 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:03:20.040245 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: COMMIT
[0m23:03:20.040771 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:03:20.041474 [debug] [Thread-1 (]: Using duckdb connection "model.dwd_weather.int_weather_features"
[0m23:03:20.041586 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: /* {"app": "dbt", "dbt_version": "1.10.15", "profile_name": "dwd_weather", "target_name": "dev", "node_id": "model.dwd_weather.int_weather_features"} */

      drop view if exists "weather"."main"."int_weather_features__dbt_backup" cascade
    
[0m23:03:20.041832 [debug] [Thread-1 (]: SQL status: OK in 0.000 seconds
[0m23:03:20.042279 [debug] [Thread-1 (]: On model.dwd_weather.int_weather_features: Close
[0m23:03:20.042477 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6e2dda5b-c7ee-4644-a337-0741a120463b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc71390>]}
[0m23:03:20.042699 [info ] [Thread-1 (]: 2 of 2 OK created sql view model main.int_weather_features ..................... [[32mOK[0m in 0.05s]
[0m23:03:20.042913 [debug] [Thread-1 (]: Finished running node model.dwd_weather.int_weather_features
[0m23:03:20.043391 [debug] [MainThread]: Using duckdb connection "master"
[0m23:03:20.043541 [debug] [MainThread]: On master: BEGIN
[0m23:03:20.043646 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m23:03:20.043837 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:03:20.043968 [debug] [MainThread]: On master: COMMIT
[0m23:03:20.044085 [debug] [MainThread]: Using duckdb connection "master"
[0m23:03:20.044184 [debug] [MainThread]: On master: COMMIT
[0m23:03:20.044333 [debug] [MainThread]: SQL status: OK in 0.000 seconds
[0m23:03:20.044446 [debug] [MainThread]: On master: Close
[0m23:03:20.044584 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:03:20.044683 [debug] [MainThread]: Connection 'model.dwd_weather.int_weather_features' was properly closed.
[0m23:03:20.044798 [info ] [MainThread]: 
[0m23:03:20.044921 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m23:03:20.045207 [debug] [MainThread]: Command end result
[0m23:03:20.053813 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/manifest.json
[0m23:03:20.054829 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/semantic_manifest.json
[0m23:03:20.057111 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/norangmangto/works/data_engineering/dwd_weather_prediction/transform/target/run_results.json
[0m23:03:20.057233 [info ] [MainThread]: 
[0m23:03:20.057376 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:03:20.057489 [info ] [MainThread]: 
[0m23:03:20.057611 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=2
[0m23:03:20.058657 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.5389694, "process_in_blocks": "0", "process_kernel_time": 0.122772, "process_mem_max_rss": "182501376", "process_out_blocks": "0", "process_user_time": 0.927345}
[0m23:03:20.058817 [debug] [MainThread]: Command `dbt run` succeeded at 23:03:20.058784 after 0.54 seconds
[0m23:03:20.058946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be1e3f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8a2c30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bc4ba50>]}
[0m23:03:20.059067 [debug] [MainThread]: Flushing usage events
[0m23:03:20.473366 [debug] [MainThread]: An error was encountered while trying to flush usage events
